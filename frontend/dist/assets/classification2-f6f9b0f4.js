import{l as Z,d as B,u as ee,c as oe}from"./classification2-af1f07fb.js";import{l as ae}from"./classification1-b6bac3e9.js";import{d as te,a as R,r as u,A as ie,b as r,o as x,n as D,g as d,f as l,e as n,j as b,C as le,i as t,q as ne,I as se,c as re,D as ce,M as g,p as de,k as me}from"./index-6d07a472.js";import{F as fe}from"./FileImageOutlined-f434a06d.js";import{_ as ge}from"./_plugin-vue_export-helper-c27b6911.js";const K=h=>(de("data-v-2c6e2e65"),h=h(),me(),h),pe={class:"page-view"},_e={class:"table-operations"},ue={key:0},he=["onClick"],ve=K(()=>d("a",{href:"#"},"删除",-1)),ye={style:{"padding-right":"16px","max-height":"480px","overflow-x":"hidden","overflow-y":"auto"}},we={class:"ant-upload-drag-icon"},ke=["src"],xe=K(()=>d("p",{class:"ant-upload-text"}," 请选择要上传的封面图片 ",-1)),be=te({__name:"classification2",setup(h){const N=R([{title:"序号",dataIndex:"id",key:"id",width:60},{title:"二级分类",dataIndex:"name",key:"name"},{title:"一级分类",dataIndex:"classification_1_name",key:"classification_1_name"},{title:"简介",dataIndex:"description",key:"description",customRender:({text:o,record:a,index:i,column:_})=>o?o.length>40?o.substring(0,40)+"...":o:"--",width:600},{title:"操作",dataIndex:"action",key:"operation",align:"center",fixed:"right",width:140}]),$=o=>{const a=new Date().getTime().toString()+"."+o.type.substring(6),i=new File([o],a);console.log(i);const _=new FileReader;return _.onload=y=>{const f=new Image;f.onload=()=>{e.form.imageUrl=y.target.result,console.log(e.form.imageUrl);const U=f.width,I=f.height;e.form.imageWidth=U,e.form.imageHeight=I,console.log(e.form.imageWidth),console.log(e.form.imageHeight)},f.src=y.target.result},_.readAsDataURL(i),e.form.imageFile=i,!1},v=u([]),H=u([]),m=u(!1),s=R({userList:[],loading:!1,currentAdminUserName:"",keyword:"",selectedRowKeys:[],pageSize:10,page:1}),e=R({visile:!1,editFlag:!1,bData:[],title:"",form:{id:void 0,name:void 0,description:"",classification_1:void 0,image:void 0,imageUrl:"",imageFile:void 0,imageWidth:void 0,imageHeight:void 0},rules:{name:[{required:!0,message:"请输入",trigger:"change"}],classification1:[{required:!0,message:"请选择一级分类",trigger:"change"}]}}),C=u();ie(()=>{p(),W()});const p=()=>{s.loading=!0,Z({keyword:s.keyword}).then(o=>{s.loading=!1,o.data.forEach((a,i)=>{a.index=i+1}),s.userList=o.data,console.log(o)}).catch(o=>{s.loading=!1,console.log(o)})},W=()=>{ae({}).then(o=>{e.bData=o.data})},E=u({onChange:(o,a)=>{console.log(`selectedRowKeys: ${o}`,"selectedRows: ",a),s.selectedRowKeys=o}}),M=()=>{L(),e.visile=!0,e.editFlag=!1,e.title="新增";for(const o in e.form)e.form[o]=void 0;e.form.image=void 0},V=o=>{L(),e.visile=!0,e.editFlag=!0,e.title="编辑";for(const i in e.form)e.form[i]=void 0;for(const i in o)e.form[i]=o[i];e.form.imageUrl=ce+e.form.image;const a=new Image;a.onload=()=>{e.form.imageWidth=a.width,e.form.imageHeight=a.height},a.src=e.form.imageUrl,e.form.image=void 0},q=o=>{console.log("delete",o),B({ids:o.id}).then(a=>{p()}).catch(a=>{g.error(a.msg||"删除失败")})},O=()=>{if(console.log(s.selectedRowKeys),s.selectedRowKeys.length<=0){console.log("hello"),g.warn("请勾选删除项");return}B({ids:s.selectedRowKeys.join(",")}).then(o=>{g.success("删除成功"),s.selectedRowKeys=[],p()}).catch(o=>{g.error(o.msg||"删除失败")})},S=()=>{var o;(o=C.value)==null||o.validate().then(()=>{const a=new FormData;e.editFlag&&a.append("id",e.form.id||""),a.append("name",e.form.name||""),e.form.classification_1&&(console.log("here"),a.append("classification_1",e.form.classification_1)),e.form.imageFile&&a.append("image",e.form.imageFile),a.append("description",e.form.description||""),console.log(e.form),e.editFlag?(m.value=!0,ee({id:e.form.id},a).then(i=>{m.value=!1,F(),p()}).catch(i=>{m.value=!1,console.log(i),g.error(i.msg||"操作失败")})):(m.value=!0,oe(a).then(i=>{m.value=!1,F(),p()}).catch(i=>{m.value=!1,console.log(i),g.error(i.msg||"操作失败")}))}).catch(a=>{console.log("不能为空")})},A=()=>{F()},L=()=>{var o;(o=C.value)==null||o.resetFields(),v.value=[],H.value=[]},F=()=>{e.visile=!1};return(o,a)=>{const i=r("a-button"),_=r("a-space"),y=r("a-divider"),f=r("a-popconfirm"),U=r("a-table"),I=r("a-input"),w=r("a-form-item"),k=r("a-col"),T=r("a-select"),j=r("a-upload-dragger"),G=r("a-textarea"),J=r("a-row"),P=r("a-form"),Q=r("a-modal");return x(),D("div",null,[d("div",pe,[d("div",_e,[l(_,null,{default:n(()=>[l(i,{type:"primary",onClick:M},{default:n(()=>[b("新增")]),_:1}),l(i,{onClick:O},{default:n(()=>[b("批量删除")]),_:1})]),_:1})]),l(U,{size:"middle",rowKey:"id",loading:t(s).loading,columns:t(N),"data-source":t(s).userList,scroll:{x:"max-content"},"row-selection":t(E),pagination:{size:"default",current:t(s).page,pageSize:t(s).pageSize,onChange:c=>t(s).page=c,showSizeChanger:!1,showTotal:c=>`共${c}条数据`}},{bodyCell:n(({text:c,record:z,index:Ce,column:X})=>[X.key==="operation"?(x(),D("span",ue,[d("a",{onClick:Y=>V(z)},"编辑",8,he),l(y,{type:"vertical"}),l(f,{title:"确定删除?","ok-text":"是","cancel-text":"否",onConfirm:Y=>q(z)},{default:n(()=>[ve]),_:2},1032,["onConfirm"])])):le("",!0)]),_:1},8,["loading","columns","data-source","row-selection","pagination"])]),d("div",null,[l(Q,{visible:t(e).visile,forceRender:!0,title:t(e).title,width:"880px","ok-text":"确认","cancel-text":"取消",onCancel:A,onOk:S},{footer:n(()=>[l(i,{key:"back",onClick:A},{default:n(()=>[b("取消")]),_:1}),l(i,{key:"submit",type:"primary",loading:t(m),onClick:S},{default:n(()=>[b("确认")]),_:1},8,["loading"])]),default:n(()=>[d("div",ye,[l(P,{ref_key:"myform",ref:C,"label-col":{style:{width:"80px"}},model:t(e).form,rules:t(e).rules},{default:n(()=>[l(J,{gutter:24},{default:n(()=>[l(k,{span:"24"},{default:n(()=>[l(w,{label:"二级分类",name:"name"},{default:n(()=>[l(I,{placeholder:"请输入",value:t(e).form.name,"onUpdate:value":a[0]||(a[0]=c=>t(e).form.name=c)},null,8,["value"])]),_:1})]),_:1}),l(k,{span:"12"},{default:n(()=>[l(w,{label:"一级分类",name:"classification_1_name"},{default:n(()=>[l(T,{placeholder:"请选择",allowClear:"",options:t(e).bData,"field-names":{label:"name",value:"id"},value:t(e).form.classification_1,"onUpdate:value":a[1]||(a[1]=c=>t(e).form.classification_1=c)},null,8,["options","value"])]),_:1})]),_:1}),l(k,{span:"24"},{default:n(()=>[l(w,{label:"封面"},{default:n(()=>[l(j,{name:"file",accept:"image/*",multiple:!1,"before-upload":$,"file-list":t(v),"onUpdate:file-list":a[2]||(a[2]=c=>ne(v)?v.value=c:null)},{default:n(()=>[d("p",we,[t(e).form.imageUrl?(x(),D("img",{key:0,src:t(e).form.imageUrl,style:se({width:`${160*t(e).form.imageWidth/t(e).form.imageHeight}px`,height:"160px"})},null,12,ke)):(x(),re(t(fe),{key:1}))]),xe]),_:1},8,["file-list"])]),_:1})]),_:1}),l(k,{span:"24"},{default:n(()=>[l(w,{label:"内容简介"},{default:n(()=>[l(G,{placeholder:"请输入",value:t(e).form.description,"onUpdate:value":a[3]||(a[3]=c=>t(e).form.description=c)},null,8,["value"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model","rules"])])]),_:1},8,["visible","title"])])])}}});const Se=ge(be,[["__scopeId","data-v-2c6e2e65"]]);export{Se as default};
