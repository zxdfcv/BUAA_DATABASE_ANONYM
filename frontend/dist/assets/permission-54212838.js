import{W as Y,d as Z,r as x,a as C,A as ee,b as r,o as u,n as g,g as c,f as a,e as i,j as y,C as D,F as oe,B as te,c as se,t as ne,h as ae,i as l,q as le,M as p,p as ie,k as re}from"./index-6d07a472.js";import{l as de,d as F,u as ce,c as me}from"./group-acd3db50.js";import{D as pe}from"./DownOutlined-854325f4.js";import{_ as fe}from"./_plugin-vue_export-helper-c27b6911.js";const _e=async m=>Y({url:"/myapp/admin/permission/list",params:m,data:{},headers:{}}),I=m=>(ie("data-v-ef7e941f"),m=m(),re(),m),ue={class:"page-view"},ge={class:"table-operations"},ye={key:0},he=["onClick"],ke=I(()=>c("a",{href:"#"},"删除",-1)),ve={key:1},we=I(()=>c("p",{slot:"title"},"修改权限组",-1)),xe=Z({__name:"permission",setup(m){const h=x([]),z=C([{title:"序号",dataIndex:"id",key:"id",align:"center"},{title:"权限组名称",dataIndex:"name",key:"name",align:"center"},{title:"权限组包含权限",dataIndex:"permissions",key:"permissions",align:"center"},{title:"操作",dataIndex:"action",key:"operation",align:"center",fixed:"right",width:140}]),s=C({permList:[],groupList:[],loading:!1,keyword:"",selectedRowKeys:[],pageSize:10,page:1}),e=C({visile:!1,editFlag:!1,title:"",form:{id:void 0,permissions:[],name:void 0,selectedKeys:[]},rules:{name:[{required:!0,message:"请输入",trigger:"change"}]}}),k=x();ee(()=>{f(),B()});const B=()=>{s.loading=!0,_e({keyword:s.keyword}).then(o=>{s.loading=!1,console.log(o.data),s.permList=o.data,s.permList.forEach(t=>{t.id=String(t.id)}),console.log(s.permList)}).catch(o=>{s.loading=!1,console.log(o)})},f=()=>{s.loading=!0,de({keyword:s.keyword}).then(o=>{s.loading=!1,console.log(o),s.groupList=o.data}).catch(o=>{s.loading=!1,console.log(o)})},E=x({onChange:(o,t)=>{console.log(`selectedRowKeys: ${o}`,"selectedRows: ",t),s.selectedRowKeys=o}}),M=()=>{K(),e.visile=!0,e.editFlag=!1,e.title="新增";for(const o in e.form)e.form[o]=void 0;e.form.permissions=[],e.form.selectedKeys=[]},$=o=>{K(),e.visile=!0,e.editFlag=!0,e.title="编辑";for(const n in e.form)e.form[n]=void 0;for(const n in o)e.form[n]=o[n];e.form.permissions.forEach(n=>{n.id=String(n.id)}),console.log(e.form.permissions);const t=[];for(let n=0;n<e.form.permissions.length;++n)t.push(String(e.form.permissions[n].id));e.form.selectedKeys=t},N=o=>{console.log("delete",o),F({ids:o.id}).then(t=>{f()}).catch(t=>{p.error(t.msg||"操作失败")})},V=()=>{if(console.log(s.selectedRowKeys),s.selectedRowKeys.length<=0){console.log("hello"),p.warn("请勾选删除项");return}F({ids:s.selectedRowKeys.join(",")}).then(o=>{p.success("删除成功"),s.selectedRowKeys=[],f()}).catch(o=>{p.error(o.msg||"操作失败")})},O=()=>{var o;(o=k.value)==null||o.validate().then(()=>{const t=new FormData;e.form.name&&t.append("name",e.form.name),e.form.permissions&&(console.log(e.form.permissions),console.log(s.permList),e.form.selectedKeys.forEach(n=>{t.append("permissions",n),console.log(n)})),e.editFlag?ce({group_id:e.form.id},t).then(n=>{v(),f()}).catch(n=>{p.error(n.msg||"操作失败")}):me(t).then(n=>{v(),f()}).catch(n=>{p.error(n.msg||"操作失败")})}).catch(t=>{console.log("不能为空")})},U=()=>{v()},K=()=>{var o;(o=k.value)==null||o.resetFields()},v=()=>{e.visile=!1};return(o,t)=>{const n=r("a-button"),j=r("a-space"),S=r("a-divider"),q=r("a-popconfirm"),T=r("a-menu-item"),P=r("a-menu"),W=r("a-dropdown"),G=r("a-table"),H=r("a-input"),b=r("a-form-item"),L=r("a-col"),J=r("a-row"),Q=r("a-transfer"),R=r("a-form"),X=r("a-modal");return u(),g("div",null,[c("div",ue,[c("div",ge,[a(j,null,{default:i(()=>[a(n,{type:"primary",onClick:M},{default:i(()=>[y("新增")]),_:1}),a(n,{onClick:V},{default:i(()=>[y("批量删除")]),_:1})]),_:1})]),a(G,{size:"middle",rowKey:"id",loading:l(s).loading,columns:l(z),"data-source":l(s).groupList,scroll:{x:"max-content"},"row-selection":l(E),pagination:{size:"default",current:l(s).page,pageSize:l(s).pageSize,onChange:d=>l(s).page=d,showSizeChanger:!1,showTotal:d=>`共${d}条数据`}},{bodyCell:i(({text:d,record:w,index:Ce,column:A})=>[A.key==="operation"?(u(),g("span",ye,[c("a",{onClick:_=>$(w)},"编辑",8,he),a(S,{type:"vertical"}),a(q,{title:"确定删除?","ok-text":"是","cancel-text":"否",onConfirm:_=>N(w)},{default:i(()=>[ke]),_:2},1032,["onConfirm"])])):D("",!0),A.key==="permissions"?(u(),g("span",ve,[a(S,{type:"vertical"}),a(W,{trigger:["click"]},{overlay:i(()=>[a(P,null,{default:i(()=>[(u(!0),g(oe,null,te(w.permissions,_=>(u(),se(T,{key:_},{default:i(()=>[y(ne(_.id+": "+_.name),1)]),_:2},1024))),128))]),_:2},1024)]),default:i(()=>[c("a",{class:"ant-dropdown-link",onClick:t[0]||(t[0]=ae(()=>{},["prevent"]))},[y(" 点我 "),a(l(pe))])]),_:2},1024)])):D("",!0)]),_:1},8,["loading","columns","data-source","row-selection","pagination"])]),c("div",null,[a(X,{visible:l(e).visile,forceRender:!0,title:l(e).title,"ok-text":"确认","cancel-text":"取消",onCancel:U,onOk:O},{default:i(()=>[c("div",null,[a(R,{ref_key:"myform",ref:k,"label-col":{style:{width:"80px"}},model:l(e).form,rules:l(e).rules},{default:i(()=>[a(J,{gutter:24},{default:i(()=>[a(L,{span:"24"},{default:i(()=>[a(b,{label:"权限组名称",name:"name"},{default:i(()=>[a(H,{placeholder:"请输入",value:l(e).form.name,"onUpdate:value":t[1]||(t[1]=d=>l(e).form.name=d)},null,8,["value"])]),_:1})]),_:1})]),_:1}),a(L,{offset:"1",span:"23"},{default:i(()=>[we,a(R,{"label-width":40},{default:i(()=>[a(b,null,{default:i(()=>[a(Q,{rowKey:d=>d.id,"list-style":{width:"300px"},dataSource:l(s).permList,"selected-keys":l(h),"onUpdate:selected-keys":t[2]||(t[2]=d=>le(h)?h.value=d:null),"target-keys":l(e).form.selectedKeys,"onUpdate:target-keys":t[3]||(t[3]=d=>l(e).form.selectedKeys=d),render:d=>d.name,titles:["可用分组","当前分组"],filterable:""},null,8,["rowKey","dataSource","selected-keys","target-keys","render"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model","rules"])])]),_:1},8,["visible","title"])])])}}});const Re=fe(xe,[["__scopeId","data-v-ef7e941f"]]);export{Re as default};
