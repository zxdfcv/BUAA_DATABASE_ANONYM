import{l as X,d as A,u as Y,c as Z}from"./canteen-860ad73f.js";import{d as ee,a as b,z as u,k as oe,r,o as v,b as C,e as d,l as a,x as s,E as h,y as te,f as l,A as ae,c as le,B as ne,m as p,p as se,g as ie}from"./index-68c43909.js";import{F as re}from"./FileImageOutlined-a57dacfb.js";import{_ as ce}from"./_plugin-vue_export-helper-c27b6911.js";const z=_=>(se("data-v-a257b930"),_=_(),ie(),_),de={class:"page-view"},me={class:"table-operations"},pe={key:0},fe=["onClick"],ue=z(()=>d("a",{href:"#"},"删除",-1)),_e={style:{"padding-right":"16px","max-height":"480px","overflow-x":"hidden","overflow-y":"auto"}},ge={class:"ant-upload-drag-icon"},ve=["src"],he=z(()=>d("p",{class:"ant-upload-text"}," 请选择要上传的封面图片 ",-1)),ye=ee({__name:"canteen",setup(_){const B=b([{title:"序号",dataIndex:"id",key:"id",width:60},{title:"食堂名称",dataIndex:"title",key:"title"},{title:"简介",dataIndex:"description",key:"description",customRender:({text:o,record:t,index:n,column:U})=>o?o.substring(0,40)+"...":"--",width:600},{title:"操作",dataIndex:"action",key:"operation",align:"center",fixed:"right",width:140}]),K=o=>{const t=new Date().getTime().toString()+"."+o.type.substring(6),n=new File([o],t);return console.log(n),e.form.imageFile=n,!1},g=u([]),L=u([]),m=u(!1),i=b({userList:[],loading:!1,currentAdminUserName:"",keyword:"",selectedRowKeys:[],pageSize:10,page:1}),e=b({visile:!1,editFlag:!1,title:"",form:{id:void 0,title:void 0,cover:void 0,coverUrl:void 0,imageFile:void 0},rules:{title:[{required:!0,message:"请输入",trigger:"change"}]}}),y=u();oe(()=>{f()});const f=()=>{i.loading=!0,X({keyword:i.keyword}).then(o=>{i.loading=!1,console.log(o),o.data.forEach((t,n)=>{t.index=n+1}),i.userList=o.data}).catch(o=>{i.loading=!1,console.log(o)})},D=u({onChange:(o,t)=>{console.log(`selectedRowKeys: ${o}`,"selectedRows: ",t),i.selectedRowKeys=o}}),N=()=>{S(),e.visile=!0,e.editFlag=!1,e.title="新增";for(const o in e.form)e.form[o]=void 0;e.form.cover=void 0},E=o=>{S(),e.visile=!0,e.editFlag=!0,e.title="编辑";for(const t in e.form)e.form[t]=void 0;for(const t in o)e.form[t]=o[t];e.form.cover&&(e.form.coverUrl=ne+e.form.cover,e.form.cover=void 0)},V=o=>{console.log("delete",o),A({ids:o.id}).then(t=>{f()}).catch(t=>{p.error(t.msg||"删除失败")})},$=()=>{if(console.log(i.selectedRowKeys),i.selectedRowKeys.length<=0){console.log("hello"),p.warn("请勾选删除项");return}A({ids:i.selectedRowKeys.join(",")}).then(o=>{p.success("删除成功"),i.selectedRowKeys=[],f()}).catch(o=>{p.error(o.msg||"删除失败")})},F=()=>{var o;(o=y.value)==null||o.validate().then(()=>{const t=new FormData;e.editFlag&&t.append("id",e.form.id),t.append("title",e.form.title),e.form.imageFile&&t.append("cover",e.form.imageFile),t.append("description",e.form.description||""),e.editFlag?(m.value=!0,Y({id:e.form.id},t).then(n=>{m.value=!1,w(),f()}).catch(n=>{m.value=!1,console.log(n),p.error(n.msg||"操作失败")})):(m.value=!0,Z(t).then(n=>{m.value=!1,w(),f()}).catch(n=>{m.value=!1,console.log(n),p.error(n.msg||"操作失败")}))}).catch(t=>{console.log("不能为空")})},R=()=>{w()},S=()=>{var o;(o=y.value)==null||o.resetFields(),g.value=[],L.value=[]},w=()=>{e.visile=!1};return(o,t)=>{const n=r("a-button"),U=r("a-space"),M=r("a-divider"),O=r("a-popconfirm"),T=r("a-table"),j=r("a-input"),k=r("a-form-item"),x=r("a-col"),q=r("a-upload-dragger"),G=r("a-textarea"),H=r("a-row"),J=r("a-form"),P=r("a-modal");return v(),C("div",null,[d("div",de,[d("div",me,[a(U,null,{default:s(()=>[a(n,{type:"primary",onClick:N},{default:s(()=>[h("新增")]),_:1}),a(n,{onClick:$},{default:s(()=>[h("批量删除")]),_:1})]),_:1})]),a(T,{size:"middle",rowKey:"id",loading:l(i).loading,columns:l(B),"data-source":l(i).userList,scroll:{x:"max-content"},"row-selection":l(D),pagination:{size:"default",current:l(i).page,pageSize:l(i).pageSize,onChange:c=>l(i).page=c,showSizeChanger:!1,showTotal:c=>`共${c}条数据`}},{bodyCell:s(({text:c,record:I,index:we,column:Q})=>[Q.key==="operation"?(v(),C("span",pe,[d("a",{onClick:W=>E(I)},"编辑",8,fe),a(M,{type:"vertical"}),a(O,{title:"确定删除?","ok-text":"是","cancel-text":"否",onConfirm:W=>V(I)},{default:s(()=>[ue]),_:2},1032,["onConfirm"])])):te("",!0)]),_:1},8,["loading","columns","data-source","row-selection","pagination"])]),d("div",null,[a(P,{visible:l(e).visile,forceRender:!0,title:l(e).title,width:"880px","ok-text":"确认","cancel-text":"取消",onCancel:R,onOk:F},{footer:s(()=>[a(n,{key:"back",onClick:R},{default:s(()=>[h("取消")]),_:1}),a(n,{key:"submit",type:"primary",loading:l(m),onClick:F},{default:s(()=>[h("确认")]),_:1},8,["loading"])]),default:s(()=>[d("div",_e,[a(J,{ref_key:"myform",ref:y,"label-col":{style:{width:"80px"}},model:l(e).form,rules:l(e).rules},{default:s(()=>[a(H,{gutter:24},{default:s(()=>[a(x,{span:"24"},{default:s(()=>[a(k,{label:"食堂名称",name:"title"},{default:s(()=>[a(j,{placeholder:"请输入",value:l(e).form.title,"onUpdate:value":t[0]||(t[0]=c=>l(e).form.title=c)},null,8,["value"])]),_:1})]),_:1}),a(x,{span:"24"},{default:s(()=>[a(k,{label:"封面"},{default:s(()=>[a(q,{name:"file",accept:"image/*",multiple:!1,"before-upload":K,"file-list":l(g),"onUpdate:file-list":t[1]||(t[1]=c=>ae(g)?g.value=c:null)},{default:s(()=>[d("p",ge,[l(e).form.coverUrl?(v(),C("img",{key:0,src:l(e).form.coverUrl,style:{width:"60px",height:"80px"}},null,8,ve)):(v(),le(l(re),{key:1}))]),he]),_:1},8,["file-list"])]),_:1})]),_:1}),a(x,{span:"24"},{default:s(()=>[a(k,{label:"内容简介"},{default:s(()=>[a(G,{placeholder:"请输入",value:l(e).form.description,"onUpdate:value":t[2]||(t[2]=c=>l(e).form.description=c)},null,8,["value"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model","rules"])])]),_:1},8,["visible","title"])])])}}});const Fe=ce(ye,[["__scopeId","data-v-a257b930"]]);export{Fe as default};
