import{W as H,X as J,a4 as Q,Y as Z,d as ee,r as x,a as w,A as te,af as oe,D as ae,b as d,o as U,n as K,g as _,f as a,e as n,j as p,C as ne,i as l,M as f,p as le,k as se}from"./index-6b603672.js";import{e as ie}from"./exportCsv-f7ca4da5.js";import{_ as re}from"./_plugin-vue_export-helper-c27b6911.js";const de=async c=>H({url:"/myapp/admin/comment/list",params:c,data:{},headers:{}}),ce=async c=>J({url:"/myapp/admin/comment/create",params:{},data:c,headers:{"Content-Type":"multipart/form-data;charset=utf-8"}}),z=async c=>Q({url:"/myapp/admin/comment/delete",params:c,headers:{}}),pe=async(c,v)=>Z({url:"/myapp/admin/comment/update",params:c,data:v,headers:{"Content-Type":"multipart/form-data;charset=utf-8"}}),ue=c=>(le("data-v-65f8347c"),c=c(),se(),c),me={class:"page-view"},fe={class:"table-operations"},_e={key:0},ge=["onClick"],ve=ue(()=>_("a",{href:"#"},"删除",-1)),ye={style:{"padding-right":"16px","max-height":"480px","overflow-x":"hidden","overflow-y":"auto"}},he=ee({__name:"comment",setup(c){const v=x(!1),D=w([{title:"序号",dataIndex:"id",key:"id",align:"center"},{title:"用户",dataIndex:"user_name",key:"user_name",align:"center"},{title:"商品名称",dataIndex:"product_name",key:"product_name",align:"center"},{title:"评论内容",dataIndex:"content",key:"content",align:"center",ellipsis:!0},{title:"评论时间",dataIndex:"create_time",key:"create_time",align:"center"},{title:"操作",dataIndex:"action",key:"operation",align:"center",fixed:"right",width:140}]),s=w({userList:[],list:[],loading:!1,currentAdminuser_name:"",keyword:"",selectedRowKeys:[],pageSize:10,page:1}),t=w({visile:!1,editFlag:!1,title:"",form:{id:void 0,product:void 0,user:void 0,content:"",likes:[],reply_count:void 0,is_read:void 0,image:void 0,link:void 0},rules:{link:[{required:!0,message:"请输入",trigger:"change"}]}});te(()=>{E(),g()});const y=x(),E=()=>{s.loading=!0,oe({}).then(o=>{s.loading=!1,console.log(o),o.data.forEach((e,i)=>{e.index=i+1}),s.userList=o.data}).catch(o=>{s.loading=!1,console.log(o)})},g=()=>{s.loading=!0,de({keyword:s.keyword}).then(o=>{s.loading=!1,console.log(o),o.data.forEach((e,i)=>{e.index=i+1,e.image&&(e.image=ae+e.image),e.is_read=e.is_read?"1":"0",console.log(e.is_read),e.content&&e.content.length>50&&(e.content=e.content.substring(0,50)+"...")}),s.list=o.data}).catch(o=>{s.loading=!1,console.log(o)})},F=x({onChange:(o,e)=>{console.log(`selectedRowKeys: ${o}`,"selectedRows: ",e),s.selectedRowKeys=o}}),L=()=>{ie(s.list,"评论信息.csv")},B=()=>{I(),t.visile=!0,t.editFlag=!1,t.title="新增";for(const o in t.form)t.form[o]=void 0},V=o=>{I(),t.visile=!0,t.editFlag=!0,t.title="编辑";for(const e in t.form)t.form[e]=void 0;for(const e in o)t.form[e]=o[e]},$=o=>{console.log("delete",o),z({ids:o.id}).then(e=>{g()}).catch(e=>{f.error(e.msg||"操作失败")})},M=()=>{if(console.log(s.selectedRowKeys),s.selectedRowKeys.length<=0){console.log("hello"),f.warn("请勾选删除项");return}z({ids:s.selectedRowKeys.join(",")}).then(o=>{f.success("删除成功"),s.selectedRowKeys=[],g()}).catch(o=>{f.error(o.msg||"操作失败")})},C=()=>{var o;(o=y.value)==null||o.validate().then(()=>{const e=new FormData;t.form.product&&e.append("product",t.form.product),t.form.content&&e.append("content",t.form.content),t.form.user&&e.append("user",t.form.user),t.form.likes&&t.form.likes.forEach(i=>{e.append("likes",i)}),t.form.is_read&&e.append("is_read",t.form.is_read==="1"?"true":"false"),t.form.reply_count&&e.append("reply_count",t.form.reply_count),t.editFlag?pe({comment_id:t.form.id},e).then(i=>{h(),g()}).catch(i=>{console.log(i),f.error(i.msg||"操作失败")}):ce(e).then(i=>{h(),g()}).catch(i=>{console.log(i),f.error(i.msg||"操作失败")})}).catch(e=>{console.log("不能为空")})},b=()=>{h()},I=()=>{var o;(o=y.value)==null||o.resetFields()},h=()=>{t.visile=!1};return(o,e)=>{const i=d("a-button"),N=d("a-space"),T=d("a-divider"),j=d("a-popconfirm"),O=d("a-table"),k=d("a-input"),u=d("a-form-item"),m=d("a-col"),q=d("a-textarea"),S=d("a-select"),A=d("a-select-option"),P=d("a-row"),W=d("a-form"),X=d("a-modal");return U(),K("div",null,[_("div",me,[_("div",fe,[a(N,null,{default:n(()=>[a(i,{type:"primary",onClick:L},{default:n(()=>[p("导出 CSV")]),_:1}),a(i,{type:"primary",onClick:B},{default:n(()=>[p("新增")]),_:1}),a(i,{onClick:M},{default:n(()=>[p("批量删除")]),_:1})]),_:1})]),a(O,{size:"middle",rowKey:"id",loading:l(s).loading,columns:l(D),"data-source":l(s).list,scroll:{x:"max-content"},"row-selection":l(F),pagination:{size:"default",current:l(s).page,pageSize:l(s).pageSize,onChange:r=>l(s).page=r,showSizeChanger:!1,showTotal:r=>`共${r}条数据`}},{bodyCell:n(({text:r,record:R,index:ke,column:Y})=>[Y.key==="operation"?(U(),K("span",_e,[_("a",{onClick:G=>V(R)},"编辑",8,ge),a(T,{type:"vertical"}),a(j,{title:"确定删除?","ok-text":"是","cancel-text":"否",onConfirm:G=>$(R)},{default:n(()=>[ve]),_:2},1032,["onConfirm"])])):ne("",!0)]),_:1},8,["loading","columns","data-source","row-selection","pagination"])]),_("div",null,[a(X,{visible:l(t).visile,forceRender:!0,title:l(t).title,width:"880px","ok-text":"确认","cancel-text":"取消",onCancel:b,onOk:C},{footer:n(()=>[a(i,{key:"back",onClick:b},{default:n(()=>[p("取消")]),_:1}),a(i,{key:"submit",type:"primary",loading:l(v),onClick:C},{default:n(()=>[p("确认")]),_:1},8,["loading"])]),default:n(()=>[_("div",ye,[a(W,{ref_key:"myform",ref:y,"label-col":{style:{width:"80px"}},model:l(t).form,rules:l(t).rules},{default:n(()=>[a(P,{gutter:24},{default:n(()=>[a(m,{span:"12"},{default:n(()=>[a(u,{label:"用户 id",name:"receiver_id"},{default:n(()=>[a(k,{placeholder:"请输入",value:l(t).form.user,"onUpdate:value":e[0]||(e[0]=r=>l(t).form.user=r)},null,8,["value"])]),_:1})]),_:1}),a(m,{span:"12"},{default:n(()=>[a(u,{label:"商品 id",name:"product_id"},{default:n(()=>[a(k,{placeholder:"请输入",value:l(t).form.product,"onUpdate:value":e[1]||(e[1]=r=>l(t).form.product=r)},null,8,["value"])]),_:1})]),_:1}),a(m,{span:"24"},{default:n(()=>[a(u,{label:"内容"},{default:n(()=>[a(q,{placeholder:"请输入",value:l(t).form.content,"onUpdate:value":e[2]||(e[2]=r=>l(t).form.content=r)},null,8,["value"])]),_:1})]),_:1}),a(m,{span:"24"},{default:n(()=>[a(u,{label:"回复数"},{default:n(()=>[a(k,{placeholder:"请输入",value:l(t).form.reply_count,"onUpdate:value":e[3]||(e[3]=r=>l(t).form.reply_count=r)},null,8,["value"])]),_:1})]),_:1}),a(m,{span:"24"},{default:n(()=>[a(u,{label:"点赞用户"},{default:n(()=>[a(S,{value:l(t).form.likes,"onUpdate:value":e[4]||(e[4]=r=>l(t).form.likes=r),mode:"multiple",style:{width:"100%"},placeholder:"Please select",options:l(s).userList,"field-names":{label:"username",value:"id",options:"permissions"},render:r=>r.name},null,8,["value","options","render"])]),_:1})]),_:1}),a(m,{span:"8"},{default:n(()=>[a(u,{label:"状态",name:"status"},{default:n(()=>[a(S,{placeholder:"请选择",allowClear:"",value:l(t).form.is_read,"onUpdate:value":e[5]||(e[5]=r=>l(t).form.is_read=r)},{default:n(()=>[a(A,{key:"0",value:"0"},{default:n(()=>[p("已读")]),_:1}),a(A,{key:"1",value:"1"},{default:n(()=>[p("未读")]),_:1})]),_:1},8,["value"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model","rules"])])]),_:1},8,["visible","title"])])])}}});const be=re(he,[["__scopeId","data-v-65f8347c"]]);export{be as default};
