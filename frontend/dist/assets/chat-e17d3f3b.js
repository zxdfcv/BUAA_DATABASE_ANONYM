import{H as ee}from"./header-a4e4f775.js";import{f as d,N as te,L as N,u as B,O as D,r as k,w as E,b as _,o as n,n as f,i as a,m as J,e as g,F as z,B as Q,y as O,c as v,D as M,g as u,t as w,C as P,v as ae,J as se,q as oe,j as W,l as T,P as L,p as G,k as X,A as ne,Q as j,R as re,I as H}from"./index-e9b87848.js";import{A as U}from"./avatar-4ee3f7af.js";import{_ as I}from"./_plugin-vue_export-helper-c27b6911.js";import{a as le}from"./product-b5f6e0d6.js";import"./logo_b-9bb82155.js";import"./UserOutlined-cccea923.js";var ce={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M518.3 459a8 8 0 00-12.6 0l-112 141.7a7.98 7.98 0 006.3 12.9h73.9V856c0 4.4 3.6 8 8 8h60c4.4 0 8-3.6 8-8V613.7H624c6.7 0 10.4-7.7 6.3-12.9L518.3 459z"}},{tag:"path",attrs:{d:"M811.4 366.7C765.6 245.9 648.9 160 512.2 160S258.8 245.8 213 366.6C127.3 389.1 64 467.2 64 560c0 110.5 89.5 200 199.9 200H304c4.4 0 8-3.6 8-8v-60c0-4.4-3.6-8-8-8h-40.1c-33.7 0-65.4-13.4-89-37.7-23.5-24.2-36-56.8-34.9-90.6.9-26.4 9.9-51.2 26.2-72.1 16.7-21.3 40.1-36.8 66.1-43.7l37.9-9.9 13.9-36.6c8.6-22.8 20.6-44.1 35.7-63.4a245.6 245.6 0 0152.4-49.9c41.1-28.9 89.5-44.2 140-44.2s98.9 15.3 140 44.2c19.9 14 37.5 30.8 52.4 49.9 15.1 19.3 27.1 40.7 35.7 63.4l13.8 36.5 37.8 10C846.1 454.5 884 503.8 884 560c0 33.1-12.9 64.3-36.3 87.7a123.07 123.07 0 01-87.6 36.3H720c-4.4 0-8 3.6-8 8v60c0 4.4 3.6 8 8 8h40.1C870.5 760 960 670.5 960 560c0-92.7-63.1-170.7-148.6-193.3z"}}]},name:"cloud-upload",theme:"outlined"};const ie=ce;function q(r){for(var e=1;e<arguments.length;e++){var s=arguments[e]!=null?Object(arguments[e]):{},l=Object.keys(s);typeof Object.getOwnPropertySymbols=="function"&&(l=l.concat(Object.getOwnPropertySymbols(s).filter(function(o){return Object.getOwnPropertyDescriptor(s,o).enumerable}))),l.forEach(function(o){de(r,o,s[o])})}return r}function de(r,e,s){return e in r?Object.defineProperty(r,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):r[e]=s,r}var F=function(e,s){var l=q({},e,s.attrs);return d(te,q({},l,{icon:ie}),null)};F.displayName="CloudUploadOutlined";F.inheritAttrs=!1;const _e=F;const pe={class:"chat-session lg:w-20% w-70% p-8px box-border"},ue=["onClick"],he={key:0},me={key:1},fe={class:"text-left",style:{"margin-left":"10px"}},ge={class:"truncate"},ve={style:{color:"#8d8d8d","font-size":"12px",width:"150px","white-space":"nowrap",overflow:"hidden","text-overflow":"ellipsis"}},xe={__name:"ChatDomain",setup(r){const e=N(),s=B(),l=D(()=>e.chat_list),o=k(-1);E(()=>e.sessionSelectId,()=>{o.value=e.sessionSelectId});const m=(x,y)=>{e.sessionSelectId=y,e.fillMessage()};return(x,y)=>{const S=_("a-page-header"),p=_("a-avatar"),t=_("a-badge"),c=_("el-row"),b=_("el-empty"),$=_("el-scrollbar");return n(),f("div",pe,[d(S,{"sub-title":"返回个人中心",onBack:y[0]||(y[0]=()=>a(J).push({name:"usercenter",query:{id:a(s).user_id}}))}),d($,{"max-height":"500px",style:{"margin-left":"15px","margin-right":"15px"}},{default:g(()=>[a(l).length!==0?(n(!0),f(z,{key:0},Q(a(l),(i,C)=>(n(),f(z,{key:i},[(n(),f("div",{key:0,class:O(["session-item",[C===a(o)?"session-active":""]]),style:{cursor:"pointer"},onClick:V=>m(i,C)},[d(c,{type:"flex",align:"middle",style:{"min-height":"75px","margin-bottom":"1px","margin-left":"10px"}},{default:g(()=>[d(t,{dot:!i.is_read&&i.sender!==a(s).user_id},{default:g(()=>[i.sender!==a(s).user_id?(n(),f("div",he,[i.sender_avatar===""||i.sender_avatar===null||i.sender_avatar===void 0?(n(),v(p,{key:1,src:a(U)},null,8,["src"])):(n(),v(p,{key:0,size:"40",src:a(M)+"/upload/"+i.sender_avatar},null,8,["src"]))])):(n(),f("div",me,[i.recipient_avatar===""||i.recipient_avatar===null||i.recipient_avatar===void 0?(n(),v(p,{key:1,src:a(U)},null,8,["src"])):(n(),v(p,{key:0,size:"40",src:a(M)+"/upload/"+i.recipient_avatar},null,8,["src"]))]))]),_:2},1032,["dot"]),u("div",fe,[u("div",ge,w(i.product_name)+" - "+w(i.sender===a(s).user_id?i.recipient_name:i.sender_name),1),u("div",ve,w(i.content),1)])]),_:2},1024)],10,ue))],64))),128)):(n(),v(b,{key:1,"image-size":100,description:"当前列表为空"}))]),_:1})])}}},ye=I(xe,[["__scopeId","data-v-dccb336a"]]);function R(r){let e=Date.parse(r);(""+e).length===10?e=parseInt(String(e))*1e3:e=+e;const s=+new Date(e),o=(Date.now()-s)/1e3;return o<30?"刚刚":o<3600?Math.ceil(o/60)+"分钟前":o<3600*24?Math.ceil(o/3600)+"小时前":r}const be=r=>(G("data-v-04158ec9"),r=r(),X(),r),we={class:"px-20px",style:{width:"80%"}},Ce={class:"edit-box",style:{display:"flex"}},ke={class:"text-left"},Se={class:"right-box"},$e=be(()=>u("p",{class:"tip"},"限制200字以内",-1)),Ie={class:"text-right mt-10px",style:{"align-self":"center","padding-left":"20px"}},De={__name:"ChatFoot",setup(r){const e=N(),s=B(),l=k(""),o=k([]),m=k(!1),x=()=>{const p=e.chat_list[e.sessionSelectId];if(console.log(p),l.value.length>0&&o.value.length>0){T({type:"warning",message:"不允许同时发送图片和文字！"});return}else if(l.value.length>0)m.value=!0,L({recipient:p.sender===s.user_id?p.recipient:p.sender,product:p.product,content:l.value}).then(async t=>{console.log(t.data),await e.handleChat(""),l.value="",m.value=!1}).catch(t=>{console.log(t),m.value=!1});else if(o.value.length>0){m.value=!0;let t=new FormData;t.append("recipient",p.sender===s.user_id?p.recipient:p.sender),t.append("product",p.product),t.append("content","[图片]"),t.append("image",o.value[0]),L(t).then(async c=>{console.log(c.data),await e.handleChat(""),o.value=[],m.value=!1}).catch(c=>{console.log(c),m.value=!1})}else{T({type:"error",message:"需要至少发送图片和文字中的一种！"});return}console.log(l.value)},y=p=>{const t=new Date().getTime().toString()+"."+p.type.substring(6),c=new File([p],t);return console.log(c),o.value=[...o.value||[],c],!1},S=()=>(o.value=[],!0);return(p,t)=>{const c=_("a-divider"),b=_("a-button"),$=_("a-upload"),i=_("el-row");return n(),f("footer",we,[d(c),d(i,{type:"flex",class:"mb-10px"},{default:g(()=>[d($,{name:"file",accept:"image/*","file-list":a(o),multiple:!1,"max-count":1,"before-upload":y,onRemove:S},{default:g(()=>[d(b,{shape:"circle"},{icon:g(()=>[d(a(_e))]),_:1})]),_:1},8,["file-list"])]),_:1}),u("div",Ce,[u("div",ke,[u("div",Se,[ae(u("textarea",{"onUpdate:modelValue":t[0]||(t[0]=C=>oe(l)?l.value=C:null),placeholder:"请输入消息内容",maxlength:"200",class:"intro"},`\r
          `,512),[[se,a(l)]]),$e])]),u("div",Ie,[d(b,{onClick:x,loading:a(m)},{default:g(()=>[W("发 送")]),_:1},8,["loading"])])])])}}},Oe=I(De,[["__scopeId","data-v-04158ec9"]]);const ze=r=>(G("data-v-b6c062af"),r=r(),X(),r),Me={class:"lg:w-73% w-100%",style:{height:"fit-content","margin-left":"10px",width:"71%"}},Ue={key:0},Ne={class:"text-left px-20px h-35px",style:{"font-size":"20px",height:"35px","text-align":"left","margin-top":"5px"}},Be={class:"fw-600",style:{"margin-left":"10px","font-weight":"600"}},Fe={class:"px-20px h-500px",style:{"background-image":"linear-gradient(whitesmoke, white)"}},Ve={class:"p-20px"},Ae={class:"text-12px my-20px text-center",style:{color:"var(--el-color-primary)","text-align":"center","margin-top":"10px"}},Pe=ze(()=>u("i",{i:"ep-loading",style:{color:"var(--el-color-primary-light-3)"}},null,-1)),Te={__name:"ChatContent",setup(r){const e=B(),s=N(),l=k(null),o=k(!1);ne(()=>{j(()=>{var t;s.chatScrollbar=l.value,(t=s.chatScrollbar)==null||t.setScrollTop(9999)})}),E(()=>s.sessionSelectId,()=>{j(()=>{var t;s.chatScrollbar=l.value,(t=s.chatScrollbar)==null||t.setScrollTop(9999)})});const m=D(()=>{let t=[];for(let c=s.message_list.length-1;c>=0;c--)t.push(s.message_list[c]);return t}),x=D(()=>(S(s.chat_list[s.sessionSelectId].product),s.chat_list[s.sessionSelectId])),y=D(()=>(t,c,b)=>(console.log(t.create_time,R(t.create_time),Date.parse(t.create_time)),t&&c===0||t&&Date.parse(t.create_time)-Date.parse(b[c-1].create_time)>5*60*1e3?`- - ${R(t.create_time)} - -`:""));re(()=>{s.sessionSelectId=-1});const S=async t=>{const c=await p(t);console.log(c!==e.user_id),o.value=c!==e.user_id},p=async t=>(await le({product_id:t})).data.merchant;return(t,c)=>{const b=_("a-button"),$=_("a-divider"),i=_("a-avatar"),C=_("el-image"),V=_("el-icon"),Y=_("el-row"),Z=_("el-scrollbar"),K=_("a-empty");return n(),f("div",Me,[a(s).sessionSelectId!==-1&&a(s).chat_list.length!==0?(n(),f("div",Ue,[u("header",Ne,[u("span",Be,w(a(x).product_name)+" - 用户： "+w(a(x).sender===a(e).user_id?a(x).recipient_name:a(x).sender_name),1),a(o)?(n(),v(b,{key:0,onClick:c[0]||(c[0]=h=>{a(J).push({name:"purchase",query:{product:a(x).product}})}),type:"primary",style:{"margin-top":"-5px","margin-left":"20px"}},{default:g(()=>[W("购买商品")]),_:1})):P("",!0),d($)]),u("div",Fe,[d(Z,{class:"rounded-6px box-border","max-height":"350px",ref_key:"chatScrollbar",ref:l,style:{background:"var(--el-color-primary-light-9)"}},{default:g(()=>[u("div",Ve,[(n(!0),f(z,null,Q(a(m),(h,A)=>(n(),f(z,{key:A},[u("div",Ae,w(a(y)(h,A,a(m))),1),d(Y,{type:"flex",class:"mb-20px",style:H([h.sender===a(e).user_id?"flex-direction: row-reverse;":"",{"margin-bottom":"10px"}])},{default:g(()=>[h.sender_avatar===""||h.sender_avatar===null||h.sender_avatar===void 0?(n(),v(i,{key:1,style:{"margin-left":"10px","margin-right":"10px"},src:a(U)},null,8,["src"])):(n(),v(i,{key:0,src:a(M)+"/upload/"+h.sender_avatar,style:{"margin-left":"10px","margin-right":"10px"}},null,8,["src"])),h.image===null?(n(),f("div",{key:2,class:O([h.sender===a(e).user_id?"mr-10px":"ml-10px","text break-words px-15px rounded-6px text-left py-12px"]),style:H([{display:"inline-block",padding:"7px 12px 7px 12px","box-sizing":"border-box","border-radius":"8px",position:"relative","word-break":"break-all"},h.sender!==a(e).user_id?"background-color: #fefefe":""])},w(h.content),7)):(n(),f("div",{key:3,class:O(h.sender===a(e).user_id?"mr-10px":"ml-10px")},[d(C,{class:"w-200px ha max-h-200px",style:{width:"200px","max-height":"200px",height:"auto"},src:a(M)+h.image,fit:"cover"},null,8,["src"])],2)),h.content!==""?(n(),v(V,{key:4,class:O([h.sender===a(e).user_id?"mr-10px":"ml-10px","is-loading pt-5px"]),size:"40px"},{default:g(()=>[Pe]),_:2},1032,["class"])):P("",!0)]),_:2},1032,["style"])],64))),128))])]),_:1},512)]),d(Oe,{class:"mt-20px",style:{"max-height":"230px",bottom:"0",position:"absolute"}})])):(n(),v(K,{key:1,style:{"align-self":"center","vertical-align":"center"}}))])}}},Le=I(Te,[["__scopeId","data-v-b6c062af"]]);const je={__name:"ChatContainer",setup(r){return(e,s)=>{const l=_("a-divider"),o=_("el-row"),m=_("el-card");return n(),v(m,{shadow:"hover",class:"lg:w-1200px w-full mt-30px chat-container",style:{"margin-top":"30px"}},{default:g(()=>[d(o,{type:"flex",class:"w-full border-rounded-33px",style:{"border-rounded":"33px"}},{default:g(()=>[d(ye,{class:"lg:block hidden",style:{width:"25%"}}),d(l,{type:"vertical",style:{height:"600px"}}),d(Le)]),_:1})]),_:1})}}},He=I(je,[["__scopeId","data-v-f8bbbf64"]]);const qe={class:"chat"},Re={class:"chat-content"},Ee={__name:"chat",setup(r){return(e,s)=>(n(),f("div",qe,[d(ee),u("div",Re,[d(He)])]))}},Ke=I(Ee,[["__scopeId","data-v-9be32f7a"]]);export{Ke as default};
