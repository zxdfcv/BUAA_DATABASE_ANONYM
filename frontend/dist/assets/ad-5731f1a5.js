import{j as Q,I as w,d as W,a as h,z as y,k as X,B as Y,r as c,o as v,b as k,e as m,l,x as s,E as I,y as R,f as i,m as p,p as Z,g as ee}from"./index-68c43909.js";import{_ as te}from"./_plugin-vue_export-helper-c27b6911.js";const oe=async d=>Q({url:"/myapp/admin/ad/list",params:d,data:{},headers:{}}),ae=async d=>w({url:"/myapp/admin/ad/create",params:{},data:d,headers:{"Content-Type":"multipart/form-data;charset=utf-8"}}),ne=async(d,f)=>w({url:"/myapp/admin/ad/update",params:d,data:f,headers:{"Content-Type":"multipart/form-data;charset=utf-8"}}),U=async d=>w({url:"/myapp/admin/ad/delete",params:d,headers:{}}),z=d=>(Z("data-v-386da379"),d=d(),ee(),d),le={class:"page-view"},se={class:"table-operations"},ie=["src"],de={key:1},ce=["onClick"],re=z(()=>m("a",{href:"#"},"删除",-1)),me=z(()=>m("p",{class:"ant-upload-text"}," 请选择要上传的广告图片 ",-1)),pe=W({__name:"ad",setup(d){const f=h([{title:"序号",dataIndex:"index",key:"index",align:"center"},{title:"图片",dataIndex:"imageUrl",key:"imageUrl",align:"center"},{title:"跳转链接",dataIndex:"link",key:"link",align:"center"},{title:"操作",dataIndex:"action",key:"operation",align:"center",fixed:"right",width:140}]),A=e=>{const o=new Date().getTime().toString()+"."+e.type.substring(6),n=new File([e],o);return console.log(n),t.form.imageFile=n,!1};y([]);const a=h({list:[],loading:!1,currentAdminUserName:"",keyword:"",selectedRowKeys:[],pageSize:10,page:1}),t=h({visile:!1,editFlag:!1,title:"",form:{id:void 0,image:void 0,imageFile:void 0,imageUrl:void 0,link:void 0},rules:{link:[{required:!0,message:"请输入",trigger:"change"}]}}),g=y();X(()=>{_()});const _=()=>{a.loading=!0,oe({keyword:a.keyword}).then(e=>{a.loading=!1,console.log(e),e.data.forEach((o,n)=>{o.index=n+1,o.image&&(o.imageUrl=Y+o.image)}),a.list=e.data}).catch(e=>{a.loading=!1,console.log(e)})},K=y({onChange:(e,o)=>{console.log(`selectedRowKeys: ${e}`,"selectedRows: ",o),a.selectedRowKeys=e}}),B=()=>{x(),t.visile=!0,t.editFlag=!1,t.title="新增";for(const e in t.form)t.form[e]=void 0;t.form.image=void 0},N=e=>{x(),t.visile=!0,t.editFlag=!0,t.title="编辑";for(const o in t.form)t.form[o]=void 0;for(const o in e)t.form[o]=e[o];t.form.image=void 0},D=e=>{console.log("delete",e),U({ids:e.id}).then(o=>{_()}).catch(o=>{p.error(o.msg||"操作失败")})},E=()=>{if(console.log(a.selectedRowKeys),a.selectedRowKeys.length<=0){console.log("hello"),p.warn("请勾选删除项");return}U({ids:a.selectedRowKeys.join(",")}).then(e=>{p.success("删除成功"),a.selectedRowKeys=[],_()}).catch(e=>{p.error(e.msg||"操作失败")})},T=()=>{var e;(e=g.value)==null||e.validate().then(()=>{const o=new FormData;t.form.link&&o.append("link",t.form.link),t.form.imageFile&&o.append("image",t.form.imageFile),t.editFlag?ne({id:t.form.id},o).then(n=>{u(),_()}).catch(n=>{console.log(n),p.error(n.msg||"操作失败")}):ae(o).then(n=>{u(),_()}).catch(n=>{console.log(n),p.error(n.msg||"操作失败")})}).catch(o=>{console.log("不能为空")})},V=()=>{u()},x=()=>{var e;(e=g.value)==null||e.resetFields()},u=()=>{t.visile=!1};return(e,o)=>{const n=c("a-button"),$=c("a-space"),M=c("a-divider"),j=c("a-popconfirm"),L=c("a-table"),O=c("a-upload-dragger"),C=c("a-form-item"),b=c("a-col"),q=c("a-input"),G=c("a-row"),H=c("a-form"),J=c("a-modal");return v(),k("div",null,[m("div",le,[m("div",se,[l($,null,{default:s(()=>[l(n,{type:"primary",onClick:B},{default:s(()=>[I("新增")]),_:1}),l(n,{onClick:E},{default:s(()=>[I("批量删除")]),_:1})]),_:1})]),l(L,{size:"middle",rowKey:"id",loading:i(a).loading,columns:i(f),"data-source":i(a).list,scroll:{x:"max-content"},"row-selection":i(K),pagination:{size:"default",current:i(a).page,pageSize:i(a).pageSize,onChange:r=>i(a).page=r,showSizeChanger:!1,showTotal:r=>`共${r}条数据`}},{bodyCell:s(({text:r,record:F,index:_e,column:S})=>[S.key==="imageUrl"?(v(),k("img",{key:0,src:r,style:{width:"60px",height:"40px"}},null,8,ie)):R("",!0),S.key==="operation"?(v(),k("span",de,[m("a",{onClick:P=>N(F)},"编辑",8,ce),l(M,{type:"vertical"}),l(j,{title:"确定删除?","ok-text":"是","cancel-text":"否",onConfirm:P=>D(F)},{default:s(()=>[re]),_:2},1032,["onConfirm"])])):R("",!0)]),_:1},8,["loading","columns","data-source","row-selection","pagination"])]),m("div",null,[l(J,{visible:i(t).visile,forceRender:!0,title:i(t).title,"ok-text":"确认","cancel-text":"取消",onCancel:V,onOk:T},{default:s(()=>[m("div",null,[l(H,{ref_key:"myform",ref:g,"label-col":{style:{width:"80px"}},model:i(t).form,rules:i(t).rules},{default:s(()=>[l(G,{gutter:24},{default:s(()=>[l(b,{span:"24"},{default:s(()=>[l(C,{label:"广告图片"},{default:s(()=>[l(O,{name:"file",accept:"image/*",multiple:!1,"before-upload":A},{default:s(()=>[me]),_:1})]),_:1})]),_:1}),l(b,{span:"24"},{default:s(()=>[l(C,{label:"跳转链接",name:"link"},{default:s(()=>[l(q,{placeholder:"请输入",value:i(t).form.link,"onUpdate:value":o[0]||(o[0]=r=>i(t).form.link=r)},null,8,["value"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model","rules"])])]),_:1},8,["visible","title"])])])}}});const ue=te(pe,[["__scopeId","data-v-386da379"]]);export{ue as default};
