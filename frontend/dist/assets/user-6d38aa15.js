import{f as o,N as ce,d as fe,a as z,r as b,A as ue,af as pe,b as d,o as x,n as O,g as k,e as n,j as w,C as D,i as l,q,c as me,M as v,ag as _e,ah as T,ai as ge,aj as H,p as ve,k as he}from"./index-6d07a472.js";import{l as ye}from"./group-acd3db50.js";import{e as we}from"./exportCsv-f7ca4da5.js";import{_ as ke}from"./_plugin-vue_export-helper-c27b6911.js";var be={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M400 317.7h73.9V656c0 4.4 3.6 8 8 8h60c4.4 0 8-3.6 8-8V317.7H624c6.7 0 10.4-7.7 6.3-12.9L518.3 163a8 8 0 00-12.6 0l-112 141.7c-4.1 5.3-.4 13 6.3 13zM878 626h-60c-4.4 0-8 3.6-8 8v154H214V634c0-4.4-3.6-8-8-8h-60c-4.4 0-8 3.6-8 8v198c0 17.7 14.3 32 32 32h684c17.7 0 32-14.3 32-32V634c0-4.4-3.6-8-8-8z"}}]},name:"upload",theme:"outlined"};const xe=be;function W(c){for(var f=1;f<arguments.length;f++){var u=arguments[f]!=null?Object(arguments[f]):{},p=Object.keys(u);typeof Object.getOwnPropertySymbols=="function"&&(p=p.concat(Object.getOwnPropertySymbols(u).filter(function(_){return Object.getOwnPropertyDescriptor(u,_).enumerable}))),p.forEach(function(_){Ce(c,_,u[_])})}return c}function Ce(c,f,u){return f in c?Object.defineProperty(c,f,{value:u,enumerable:!0,configurable:!0,writable:!0}):c[f]=u,c}var K=function(f,u){var p=W({},f,u.attrs);return o(ce,W({},p,{icon:xe}),null)};K.displayName="UploadOutlined";K.inheritAttrs=!1;const Ue=K;function Se(c){return new Promise((f,u)=>{const p=new FileReader;p.onload=_=>{var I;const i=((I=_.target)==null?void 0:I.result).split(`
`).map(m=>m.split(",")),t=i[0],C=i.slice(1).map(m=>{const U={};return t.forEach((R,A)=>{if(console.log(m[A]),m[0]=="")return null;let g=m[A].trim();if(console.log(g),g.startsWith('"')&&g.endsWith('"')){g=g.slice(1,-1);const F=g.split(" ").map(j=>j.trim());console.log(F),U[R.trim()]=F}else U[R.trim()]=g}),U});f(C)},p.onerror=_=>{u(_)},p.readAsText(c)})}const J=c=>(ve("data-v-0dd69145"),c=c(),he(),c),Oe={class:"page-view"},Ie={class:"table-operations"},Re={key:0},Ae={key:0},Fe={key:1},Ve={key:1},Ee=["onClick"],je=J(()=>k("a",{href:"#"},"注销",-1)),ze=J(()=>k("p",{slot:"title"},"修改权限组",-1)),De=fe({__name:"user",setup(c){const f=z([{title:"序号",dataIndex:"id",key:"id",align:"center"},{title:"用户名",dataIndex:"username",key:"username",align:"center"},{title:"昵称",dataIndex:"nickname",key:"nickname",align:"center"},{title:"角色",dataIndex:"is_staff",key:"is_staff",align:"center"},{title:"状态",dataIndex:"is_active",key:"is_active",align:"center",customRender:({text:a,record:e,index:r,column:$})=>a==="1"?"正常":"封号"},{title:"邮箱",dataIndex:"email",key:"email",align:"center"},{title:"手机号",dataIndex:"phone",key:"phone",align:"center"},{title:"创建时间",dataIndex:"date_joined",key:"date_joined",align:"center"},{title:"操作",dataIndex:"action",key:"operation",align:"center",fixed:"right",width:140}]),u=b([]),p=b([]);b([]);const _=b([]),L=a=>(Se(a).then(e=>{console.log(e),e.forEach(r=>{console.log(r),Z(r)})}).then(()=>{v.success("操作完成")}).catch(e=>{v.warn(e.msg||"操作失败, 请检查数据")}),_e.LIST_IGNORE),i=z({userList:[],allGroups:[],loading:!1,currentAdminUserName:"",keyword:"",selectedRowKeys:[],pageSize:10,page:1}),t=z({visile:!1,editFlag:!1,title:"",roleData:[{id:!0,title:"管理员"},{id:!1,title:"普通用户"}],form:{id:void 0,username:void 0,password:void 0,is_staff:void 0,is_active:void 0,nickname:void 0,email:void 0,phone:void 0,groups:[],image:void 0,imageUrl:void 0,imageFile:void 0,imageWidth:void 0,imageHeight:void 0},rules:{username:[{required:!0,message:"请输入",trigger:"change"}],password:[{required:!0,message:"请输入",trigger:"change"}],is_staff:[{required:!0,message:"请选择",trigger:"change"}],is_active:[{required:!0,message:"请选择",trigger:"change"}]}}),C=b();ue(()=>{m(),I()});const I=()=>{i.loading=!0,ye({}).then(a=>{i.loading=!1,console.log(a),a.data.forEach((e,r)=>{e.index=r+1}),i.allGroups=a.data,console.log(i.allGroups)}).catch(a=>{i.loading=!1,console.log(a)})},m=()=>{i.loading=!0,pe({keyword:i.keyword}).then(a=>{i.loading=!1,console.log(a),a.data.forEach((e,r)=>{e.index=r+1,e.is_active=e.is_active?"1":"0",e.is_staff=e.is_staff?"1":"0",console.log(e.is_active)}),i.userList=a.data}).catch(a=>{i.loading=!1,console.log(a)})},U=a=>{var e;i.keyword=(e=a==null?void 0:a.target)==null?void 0:e.value,console.log(i.keyword)},R=()=>{m()},A=b({onChange:(a,e)=>{console.log(`selectedRowKeys: ${a}`,"selectedRows: ",e),i.selectedRowKeys=a}}),g=()=>{we(i.userList,"用户信息")},F=()=>{N(),t.visile=!0,t.editFlag=!1,t.title="新增";for(const a in t.form)t.form[a]=void 0;t.form.groups=[]},j=a=>{N(),t.visile=!0,t.editFlag=!0,t.title="编辑";for(const e in t.form)t.form[e]=void 0;for(const e in a)t.form[e]=a[e]},Q=a=>{console.log("delete",a),T({ids:a.id}).then(e=>{m()}).catch(e=>{v.warn(e.msg||"操作失败")})},X=()=>{if(console.log(i.selectedRowKeys),i.selectedRowKeys.length<=0){console.log("hello"),v.warn("请勾选注销项");return}T({ids:i.selectedRowKeys.join(",")}).then(a=>{v.success("注销成功"),i.selectedRowKeys=[],m()}).catch(a=>{v.warn(a.msg||"操作失败")})},Y=()=>{var a;(a=C.value)==null||a.validate().then(()=>{const e=new FormData;t.form.username&&e.append("username",t.form.username),t.form.password&&e.append("password",t.form.password),t.form.nickname&&e.append("nickname",t.form.nickname),t.form.is_staff&&e.append("is_staff",t.form.is_staff==="1"?"true":"false"),t.form.is_active&&e.append("is_active",t.form.is_active==="1"?"true":"false"),t.form.phone&&e.append("phone",t.form.phone),t.form.email&&e.append("email",t.form.email),t.form.groups&&t.form.groups.forEach(r=>{e.append("groups",r)}),t.editFlag?ge({user_id:t.form.id},e).then(r=>{V(),m()}).catch(r=>{console.log(r),v.warn(r.msg||"操作失败")}):H(e).then(r=>{V(),m()}).catch(r=>{console.log(r),v.warn(r.msg||"操作失败")})}).catch(e=>{console.log("不能为空")})},Z=a=>{const e=new FormData;console.log(a),a.username&&e.append("username",a.username),a.password&&e.append("password",a.password),a.nickname&&e.append("nickname",a.nickname),a.is_staff&&e.append("is_staff",a.is_staff==="1"?"true":"false"),a.is_active&&e.append("is_active",a.is_active==="1"?"true":"false"),a.phone&&e.append("phone",a.phone),a.email&&e.append("email",a.email),a.groups&&a.groups.forEach(r=>{e.append("groups",r)}),H(e).then(r=>{V(),m()}).catch(r=>{console.log(r),v.warn(r.msg||"操作失败")})},ee=()=>{V()},N=()=>{var a;(a=C.value)==null||a.resetFields()},V=()=>{t.visile=!1};return(a,e)=>{const r=d("a-button"),$=d("a-input-search"),ae=d("a-space"),te=d("a-divider"),oe=d("a-popconfirm"),ne=d("a-table"),le=d("a-upload"),S=d("a-input"),h=d("a-form-item"),y=d("a-col"),E=d("a-select-option"),B=d("a-select"),se=d("a-transfer"),G=d("a-form"),re=d("a-row"),ie=d("a-modal");return x(),O("div",null,[k("div",Oe,[k("div",Ie,[o(ae,null,{default:n(()=>[o(r,{type:"primary",onClick:g},{default:n(()=>[w("导出 CSV")]),_:1}),o(r,{type:"primary",onClick:F},{default:n(()=>[w("新增")]),_:1}),o(r,{onClick:X},{default:n(()=>[w("批量注销")]),_:1}),o($,{"addon-before":"用户名","enter-button":"",onSearch:R,onChange:U})]),_:1})]),o(ne,{size:"middle",rowKey:"id",ref_key:"tableRef",ref:u,loading:l(i).loading,columns:l(f),"data-source":l(i).userList,scroll:{x:"max-content"},"row-selection":l(A),pagination:{size:"default",current:l(i).page,pageSize:l(i).pageSize,onChange:s=>l(i).page=s,showSizeChanger:!1,showTotal:s=>`共${s}条数据`}},{bodyCell:n(({text:s,record:M,index:Ke,column:P})=>[P.key==="is_staff"?(x(),O("span",Re,[s==="1"?(x(),O("span",Ae,"管理员")):(x(),O("span",Fe,"普通用户"))])):D("",!0),P.key==="operation"?(x(),O("span",Ve,[k("a",{onClick:de=>j(M)},"编辑",8,Ee),o(te,{type:"vertical"}),o(oe,{title:"确定注销?","ok-text":"是","cancel-text":"否",onConfirm:de=>Q(M)},{default:n(()=>[je]),_:2},1032,["onConfirm"])])):D("",!0)]),_:1},8,["loading","columns","data-source","row-selection","pagination"]),o(le,{"file-list":l(p),"onUpdate:file-list":e[0]||(e[0]=s=>q(p)?p.value=s:null),name:"file","max-count":1,"before-upload":L},{default:n(()=>[o(r,null,{default:n(()=>[o(l(Ue)),w(" 上传用户列表 ")]),_:1})]),_:1},8,["file-list"])]),k("div",null,[o(ie,{visible:l(t).visile,forceRender:!0,title:l(t).title,"ok-text":"确认","cancel-text":"取消",onCancel:ee,onOk:Y},{default:n(()=>[k("div",null,[o(G,{ref_key:"myform",ref:C,"label-col":{style:{width:"80px"}},model:l(t).form,rules:l(t).rules},{default:n(()=>[o(re,{gutter:24},{default:n(()=>[o(y,{span:"24"},{default:n(()=>[o(h,{label:"用户名",name:"username"},{default:n(()=>[o(S,{disabled:l(t).editFlag,placeholder:"请输入",value:l(t).form.username,"onUpdate:value":e[1]||(e[1]=s=>l(t).form.username=s),allowClear:""},null,8,["disabled","value"])]),_:1})]),_:1}),l(t).editFlag?D("",!0):(x(),me(y,{key:0,span:"24"},{default:n(()=>[o(h,{label:"密码",name:"password"},{default:n(()=>[o(S,{placeholder:"请输入",type:"password",value:l(t).form.password,"onUpdate:value":e[2]||(e[2]=s=>l(t).form.password=s),allowClear:""},null,8,["value"])]),_:1})]),_:1})),o(y,{span:"24"},{default:n(()=>[o(h,{label:"昵称",name:"nickname"},{default:n(()=>[o(S,{placeholder:"请输入",value:l(t).form.nickname,"onUpdate:value":e[3]||(e[3]=s=>l(t).form.nickname=s),allowClear:""},null,8,["value"])]),_:1})]),_:1}),o(y,{span:"24"},{default:n(()=>[o(h,{label:"角色",name:"is_staff"},{default:n(()=>[o(B,{placeholder:"请选择",allowClear:"",value:l(t).form.is_staff,"onUpdate:value":e[4]||(e[4]=s=>l(t).form.is_staff=s)},{default:n(()=>[o(E,{key:"0",value:"1"},{default:n(()=>[w("管理员")]),_:1}),o(E,{key:"1",value:"0"},{default:n(()=>[w("普通用户")]),_:1})]),_:1},8,["value"])]),_:1})]),_:1}),o(y,{span:"24"},{default:n(()=>[o(h,{label:"状态",name:"is_active"},{default:n(()=>[o(B,{placeholder:"请选择",allowClear:"",value:l(t).form.is_active,"onUpdate:value":e[5]||(e[5]=s=>l(t).form.is_active=s)},{default:n(()=>[o(E,{key:"0",value:"0"},{default:n(()=>[w("封号")]),_:1}),o(E,{key:"1",value:"1"},{default:n(()=>[w("正常")]),_:1})]),_:1},8,["value"])]),_:1})]),_:1}),o(y,{span:"24"},{default:n(()=>[o(h,{label:"邮箱",name:"email"},{default:n(()=>[o(S,{placeholder:"请输入",value:l(t).form.email,"onUpdate:value":e[6]||(e[6]=s=>l(t).form.email=s),allowClear:""},null,8,["value"])]),_:1})]),_:1}),o(y,{span:"24"},{default:n(()=>[o(h,{label:"手机号",name:"phone"},{default:n(()=>[o(S,{placeholder:"请输入",value:l(t).form.phone,"onUpdate:value":e[7]||(e[7]=s=>l(t).form.phone=s),allowClear:""},null,8,["value"])]),_:1})]),_:1}),o(y,{offset:"1",span:"23"},{default:n(()=>[ze,o(G,{"label-width":40},{default:n(()=>[o(h,null,{default:n(()=>[o(se,{rowKey:s=>s.name,"list-style":{width:"300px"},dataSource:l(i).allGroups,"selected-keys":l(_),"onUpdate:selected-keys":e[8]||(e[8]=s=>q(_)?_.value=s:null),"target-keys":l(t).form.groups,"onUpdate:target-keys":e[9]||(e[9]=s=>l(t).form.groups=s),render:s=>s.name,titles:["可用分组","当前分组"],filterable:""},null,8,["rowKey","dataSource","selected-keys","target-keys","render"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model","rules"])])]),_:1},8,["visible","title"])])])}}});const Ge=ke(De,[["__scopeId","data-v-0dd69145"]]);export{Ge as default};
