import{u as ne,z as c,a as le,k as ce,B as H,m as k,o as a,b as d,l as N,e,f as l,y as f,t as i,F as $,n as S,q as z,w as ie,v as ae,A as de,h as re,C as _e,p as ue,g as ve}from"./index-68c43909.js";import{H as he,F as me}from"./footer-1ce37bd7.js";import{R as pe,S as ge,W as fe}from"./emoji-78e8751b.js";import{A as B}from"./avatar-4ee3f7af.js";import{l as be}from"./thing-333260d6.js";import{l as W,c as j,a as ke}from"./comment-13bad695.js";import{d as we,a as Ce}from"./classification-7925674c.js";import{_ as xe}from"./_plugin-vue_export-helper-c27b6911.js";import"./logo_b-9bb82155.js";const h=w=>(ue("data-v-8bae39fe"),w=w(),ve(),w),ye={class:"detail"},Ie={class:"detail-content"},$e={class:"detail-content-top"},Se={style:{position:"relative"}},Re={class:"thing-infos-view"},De={class:"thing-infos"},Ae={key:0},Te=["src"],ze={class:"title"},Be={class:"meta"},Le={class:"desc"},Ee={class:"thing-counts hidden-sm"},Fe={class:"count-img"},Me=["src"],Ue={class:"count-box flex-view"},Ve=h(()=>e("div",{class:"count-text-box"},[e("span",{class:"count-title"},"收藏")],-1)),qe={class:"count-num-box"},He={class:"num-text"},Ne={class:"count-img"},We=["src"],je={class:"count-box flex-view"},Pe=h(()=>e("div",{class:"count-text-box"},[e("span",{class:"count-title"},"分享")],-1)),Ge={class:"count-num-box"},Je=h(()=>e("span",{class:"num-text"},null,-1)),Ke=["src"],Oe={key:0,style:{"margin-top":"24px"}},Qe=h(()=>e("img",{style:{width:"250px",height:"100px","background-size":"cover","object-fit":"cover"},src:""},null,-1)),Xe=[Qe],Ye={class:"detail-content-bottom"},Ze={class:"thing-content-view flex-view"},es={class:"main-content"},ss={class:"order-view main-tab"},ts=["onClick"],os={class:"thing-comment"},ns=h(()=>e("div",{class:"title"},"发表新的评论",-1)),ls={class:"publish flex-view"},cs=["src"],is={class:"tab-view flex-view"},as={class:"count-text"},ds={key:0,class:"tab-box flex-view"},rs=h(()=>e("div",{class:"line"},null,-1)),_s={class:"comments-list"},us={class:"comment-item"},vs={class:"flex-item flex-view"},hs=["src","onClick"],ms={class:"person"},ps={class:"name"},gs={class:"time"},fs={class:"float-right"},bs=["onClick"],ks=["onClick"],ws={class:"num"},Cs={class:"comment-content"},xs={key:0},ys={class:"publish flex-view"},Is={class:"count-text"},$s=["onClick"],Ss={key:0},Rs={class:"comment-item-sub"},Ds={class:"flex-item flex-view"},As=["src","onClick"],Ts={class:"person"},zs={class:"name"},Bs={class:"time"},Ls={class:"float-right"},Es=["onClick"],Fs=["onClick"],Ms={class:"num"},Us={class:"comment-content-sub"},Vs={key:1,class:"publish flex-view"},qs=["placeholder"],Hs=["onClick"],Ns=h(()=>e("div",{class:"infinite-loading-container"},[e("div",{class:"infinite-status-prompt",style:{}},[e("div",{slot:"no-results",class:"no-results"},[e("div"),e("p",null,"没有更多了")])])],-1)),Ws={class:"recommend",style:{}},js=h(()=>e("div",{class:"title"},"热门推荐",-1)),Ps={class:"things"},Gs=["onClick"],Js={class:"img-view"},Ks=["src"],Os={class:"info-view"},Qs={class:"thing-name"},Xs={style:{color:"#444","font-size":"11px",height:"11px"}},Ys=h(()=>e("br",null,null,-1)),Zs={style:{color:"#444","font-size":"11px",height:"11px"}},et={__name:"detailCounter",setup(w){const R=re(),P=_e(),D=ne();let G=c(),m=c(""),_=c({}),J=c(6),K=c(["评论"]),L=c(0),r=c([]),E=c([]),C=c(0),A=c("recent"),x=c();le({});let T=c(),u=c(new Map),F=c(-1),M=c(-1);const p=c("");let y=c(""),g=c(new Map);const I=(s,o)=>{if(u.value.has(s)||u.value.set(s,!1),console.log(u.value.get(s)),F.value==s&&M.value!=o||u.value.set(s,!u.value.get(s)),u.value.get(s)){if(p.value="",s==o){const t=r.value.filter(n=>n.id==o);y.value="@"+t[0].username+": ",console.log(t[0]),console.log(t[0].username)}else{const t=r.value.filter(v=>v.id==s);console.log(t[0]);const n=t[0].replies.data.filter(v=>v.id==o);y.value="@"+n[0].username+": ",console.log(n[0]),console.log(n[0].username)}for(const t in r.value)console.log(r.value[t].id),r.value[t].id!=s&&u.value.set(r.value[t].id,!1)}F.value=s,M.value=o},O=s=>{g.value.has(s)||g.value.set(s,!1),g.value.set(s,!g.value.get(s))};ce(()=>{m.value=P.query.id.trim(),U(),Z(),b();for(const s in r.value)u.value.set(s,!1),g.value.set(s,!1)});const Q=s=>{L.value=s,J.value=6+54*s},U=()=>{T=_.value.raw==null,console.log(T),we({id:m.value}).then(s=>{_.value=s.data,_.value.raw=H+_.value.raw}).catch(s=>{k.error("获取详情失败")})},X=()=>{let s=D.user_name;s?(console.log(m.value),Ce({classificationId:m.value,username:s}).then(o=>{k.success(o.msg),U()}).catch(o=>{console.log("收藏柜台失败")})):k.warn("请先登录")},Y=()=>{let o="http://service.weibo.com/share/share.php?title="+("分享一个非常好玩的网站 "+window.location.href);window.open(o)},Z=()=>{be({sort:"recommend"}).then(s=>{s.data.forEach((o,t)=>{o.cover&&(o.cover=H+o.cover)}),console.log(s),E.value=s.data.slice(0,6)}).catch(s=>{console.log(s)})},ee=s=>{let o=R.resolve({name:"detail",query:{id:s.id}});window.open(o.href,"_blank")},se=()=>{console.log(x.value.value);let s=x.value.value.trim();if(console.log(s),s.length<=0)return;x.value.value="";let o=D.user_id;o?j({content:s,thing:m.value,user:o},{}).then(t=>{b()}).catch(t=>{console.log(t)}):(k.warn("请先登录！"),R.push({name:"login"}))},te=s=>{let o=y.value+p.value.trim();if(console.log(o),o.length<=0)return;p.value="";let t=D.user_id;t?j({content:o,thing:m.value,user:t},{parentId:s}).then(n=>{b()}).catch(n=>{console.log(n)}):(k.warn("请先登录！"),R.push({name:"login"}))},V=s=>{ke({commentId:s}).then(o=>{b()}).catch(o=>{console.log(o)})},b=()=>{W({thingId:m.value,order:A.value}).then(s=>{const o=[...s.data],t=o.map(n=>W({parentId:n.id,order:A.value}));return Promise.all(t).then(n=>{n.forEach((v,oe)=>{o[oe].replies=v}),r.value=o,console.log(r.value)}).catch(n=>{console.log(n)})}).catch(s=>{console.log(s)})},q=s=>{s==="recent"?C.value=0:C.value=1,A.value=s,b()};return(s,o)=>(a(),d("div",ye,[N(he),e("div",Ie,[e("div",$e,[e("div",Se,[e("div",Re,[e("div",De,[l(T)?(a(),d("div",Ae,[e("img",{src:l(_).cover,width:"800",height:"500"},null,8,Te)])):f("",!0),e("div",ze,i(l(_).title),1),e("div",Be,i(l(_).pv)+"次浏览",1),e("div",Le,"简介："+i(l(_).description),1)]),e("div",Ee,[e("div",{class:"count-item flex-view pointer",onClick:o[0]||(o[0]=t=>X())},[e("div",Fe,[e("img",{src:l(pe)},null,8,Me)]),e("div",Ue,[Ve,e("div",qe,[e("span",He,i(l(_).collect_count),1)])])]),e("div",{class:"count-item flex-view",onClick:o[1]||(o[1]=t=>Y())},[e("div",Ne,[e("img",{src:l(ge)},null,8,We)]),e("div",je,[Pe,e("div",Ge,[Je,e("img",{src:l(fe),class:"mg-l"},null,8,Ke)])])]),l(G)?(a(),d("div",Oe,Xe)):f("",!0)])])])]),e("div",Ye,[e("div",Ze,[e("div",es,[e("div",ss,[(a(!0),d($,null,S(l(K),(t,n)=>(a(),d("span",{class:z(["tab",l(L)===n?"tab-select":""]),key:n,onClick:v=>Q(n)},i(t),11,ts))),128))]),e("div",os,[ns,e("div",ls,[e("img",{src:l(B),class:"mine-img"},null,8,cs),e("textarea",{placeholder:"说点什么...",class:"content-input",ref_key:"commentRef",ref:x},null,512),e("button",{class:"send-btn",onClick:o[2]||(o[2]=t=>se())},"发送")]),e("div",is,[e("div",as,"共有"+i(l(r).length)+"条评论",1),l(r).length>0?(a(),d("div",ds,[e("span",{class:z(l(C)===0?"tab-select":""),onClick:o[3]||(o[3]=t=>q("recent"))},"最新",2),rs,e("span",{class:z(l(C)===1?"tab-select":""),onClick:o[4]||(o[4]=t=>q("hot"))},"热门",2)])):f("",!0)]),e("div",_s,[(a(!0),d($,null,S(l(r),t=>(a(),d("div",us,[e("div",vs,[e("img",{src:l(B),class:"avator",onClick:n=>I(t.id,t.id)},null,8,hs),e("div",ms,[e("div",ps,i(t.username),1),e("div",gs,i(t.comment_time),1)]),e("div",fs,[e("span",{onClick:n=>I(t.id,t.id)},"回复",8,bs),e("span",{onClick:n=>V(t.id)},"点赞",8,ks),e("span",ws,i(t.like_count),1)])]),e("p",Cs,i(t.content),1),t.reply_count>0?(a(),d("div",xs,[e("div",ys,[e("div",Is,[e("span",null,"共有"+i(t.reply_count)+"条回复，",1),e("span",{class:"more-btn-sub",onClick:n=>O(t.id)},"点击查看",8,$s)])]),l(g).get(t.id)?(a(),d("div",Ss,[(a(!0),d($,null,S(t.replies.data,n=>(a(),d("div",Rs,[e("div",Ds,[e("img",{src:l(B),class:"avator",onClick:v=>I(t.id,n.id)},null,8,As),e("div",Ts,[e("div",zs,i(n.username),1),e("div",Bs,i(n.comment_time),1)]),e("div",Ls,[e("span",{onClick:v=>I(t.id,n.id)},"回复",8,Es),e("span",{onClick:v=>V(n.id)},"推荐",8,Fs),e("span",Ms,i(n.like_count),1)])]),e("p",Us,i(n.content),1)]))),256))])):f("",!0)])):f("",!0),l(u).get(t.id)?(a(),d("div",Vs,[ie(e("textarea",{placeholder:l(y),class:"content-input-sub","onUpdate:modelValue":o[5]||(o[5]=n=>de(p)?p.value=n:null)},null,8,qs),[[ae,l(p)]]),e("button",{class:"send-btn-sub",onClick:n=>te(t.id)},"发送",8,Hs)])):f("",!0)]))),256)),Ns])])]),e("div",Ws,[js,e("div",Ps,[(a(!0),d($,null,S(l(E),t=>(a(),d("div",{key:t.id,onClick:n=>ee(t),class:"thing-item item-column-3"},[e("div",Js,[e("img",{src:t.cover},null,8,Ks)]),e("div",Os,[e("h3",Qs,i(t.title.substring(0,12)),1),e("span",Xs,i(t.create_time.substring(0,16)),1),Ys,e("span",Zs,i(t.pv)+"次浏览",1)])],8,Gs))),128))])])])])]),N(me)]))}},rt=xe(et,[["__scopeId","data-v-8bae39fe"]]);export{rt as default};
