import{l as X,d as K,u as Y,c as Z}from"./classification1-ebb661b6.js";import{d as ee,a as I,r as _,A as oe,b as r,o as w,n as S,g as c,f as n,e as l,j as k,C as te,i,q as ae,I as ie,c as ne,D as le,M as g,p as se,k as re}from"./index-e9b87848.js";import{F as de}from"./FileImageOutlined-b428f4d0.js";import{_ as ce}from"./_plugin-vue_export-helper-c27b6911.js";const B=h=>(se("data-v-3f180ef1"),h=h(),re(),h),me={class:"page-view"},fe={class:"table-operations"},ge={key:0},pe=["onClick"],ue=B(()=>c("a",{href:"#"},"删除",-1)),_e={style:{"padding-right":"16px","max-height":"480px","overflow-x":"hidden","overflow-y":"auto"}},he={class:"ant-upload-drag-icon"},ve=["src"],ye=B(()=>c("p",{class:"ant-upload-text"}," 请选择要上传的封面图片 ",-1)),we=ee({__name:"classification1",setup(h){const N=I([{title:"序号",dataIndex:"id",key:"id",width:60},{title:"一级分类",dataIndex:"name",key:"name"},{title:"简介",dataIndex:"description",key:"description",customRender:({text:o,record:t,index:a,column:u})=>o?o.length>40?o.substring(0,40)+"...":o:"--",width:600},{title:"操作",dataIndex:"action",key:"operation",align:"center",fixed:"right",width:140}]),$=o=>{const t=new Date().getTime().toString()+"."+o.type.substring(6),a=new File([o],t);console.log(a);const u=new FileReader;return u.onload=y=>{const f=new Image;f.onload=()=>{e.form.imageUrl=String(y.target.result),console.log(e.form.imageUrl);const C=f.width,F=f.height;e.form.imageWidth=C,e.form.imageHeight=F},f.src=y.target.result},u.readAsDataURL(a),e.form.imageFile=a,!1},v=_([]),E=_([]),m=_(!1),s=I({userList:[],loading:!1,currentAdminUserName:"",keyword:"",selectedRowKeys:[],pageSize:10,page:1}),e=I({visile:!1,editFlag:!1,title:"",form:{id:void 0,name:void 0,description:void 0,image:void 0,imageUrl:"",imageFile:void 0,imageWidth:0,imageHeight:0},rules:{name:[{required:!0,message:"请输入",trigger:"change"}]}}),x=_();oe(()=>{p()});const p=()=>{s.loading=!0,X({keyword:s.keyword}).then(o=>{s.loading=!1,console.log(o),o.data.forEach((t,a)=>{t.index=a+1}),s.userList=o.data}).catch(o=>{s.loading=!1,console.log(o)})},H=_({onChange:(o,t)=>{console.log(`selectedRowKeys: ${o}`,"selectedRows: ",t),s.selectedRowKeys=o}}),M=()=>{L(),e.visile=!0,e.editFlag=!1,e.title="新增";for(const o in e.form)e.form[o]=void 0;e.form.image=void 0},V=o=>{L(),e.visile=!0,e.editFlag=!0,e.title="编辑";for(const a in e.form)e.form[a]=void 0;for(const a in o)e.form[a]=o[a];e.form.imageUrl=le+e.form.image;const t=new Image;t.onload=()=>{e.form.imageWidth=t.width,e.form.imageHeight=t.height},t.src=e.form.imageUrl,e.form.image=void 0},W=o=>{console.log("delete",o),K({ids:o.id}).then(t=>{p()}).catch(t=>{g.error(t.msg||"删除失败")})},O=()=>{if(console.log(s.selectedRowKeys),s.selectedRowKeys.length<=0){console.log("hello"),g.warn("请勾选删除项");return}K({ids:s.selectedRowKeys.join(",")}).then(o=>{g.success("删除成功"),s.selectedRowKeys=[],p()}).catch(o=>{g.error(o.msg||"删除失败")})},A=()=>{var o;(o=x.value)==null||o.validate().then(()=>{const t=new FormData;e.editFlag&&t.append("id",e.form.id||""),t.append("name",e.form.name||""),e.form.imageFile&&t.append("image",e.form.imageFile),t.append("description",e.form.description||""),e.editFlag?(m.value=!0,Y({id:e.form.id},t).then(a=>{m.value=!1,b(),p()}).catch(a=>{m.value=!1,console.log(a),g.error(a.msg||"操作失败")})):(m.value=!0,Z(t).then(a=>{m.value=!1,b(),p()}).catch(a=>{m.value=!1,console.log(a),g.error(a.msg||"操作失败")}))}).catch(t=>{console.log("不能为空")})},D=()=>{b()},L=()=>{var o;(o=x.value)==null||o.resetFields(),v.value=[],E.value=[]},b=()=>{e.visile=!1};return(o,t)=>{const a=r("a-button"),u=r("a-space"),y=r("a-divider"),f=r("a-popconfirm"),C=r("a-table"),F=r("a-input"),U=r("a-form-item"),R=r("a-col"),T=r("a-upload-dragger"),j=r("a-textarea"),q=r("a-row"),G=r("a-form"),J=r("a-modal");return w(),S("div",null,[c("div",me,[c("div",fe,[n(u,null,{default:l(()=>[n(a,{type:"primary",onClick:M},{default:l(()=>[k("新增")]),_:1}),n(a,{onClick:O},{default:l(()=>[k("批量删除")]),_:1})]),_:1})]),n(C,{size:"middle",rowKey:"id",loading:i(s).loading,columns:i(N),"data-source":i(s).userList,scroll:{x:"max-content"},"row-selection":i(H),pagination:{size:"default",current:i(s).page,pageSize:i(s).pageSize,onChange:d=>i(s).page=d,showSizeChanger:!1,showTotal:d=>`共${d}条数据`}},{bodyCell:l(({text:d,record:z,index:ke,column:P})=>[P.key==="operation"?(w(),S("span",ge,[c("a",{onClick:Q=>V(z)},"编辑",8,pe),n(y,{type:"vertical"}),n(f,{title:"确定删除?","ok-text":"是","cancel-text":"否",onConfirm:Q=>W(z)},{default:l(()=>[ue]),_:2},1032,["onConfirm"])])):te("",!0)]),_:1},8,["loading","columns","data-source","row-selection","pagination"])]),c("div",null,[n(J,{visible:i(e).visile,forceRender:!0,title:i(e).title,width:"880px","ok-text":"确认","cancel-text":"取消",onCancel:D,onOk:A},{footer:l(()=>[n(a,{key:"back",onClick:D},{default:l(()=>[k("取消")]),_:1}),n(a,{key:"submit",type:"primary",loading:i(m),onClick:A},{default:l(()=>[k("确认")]),_:1},8,["loading"])]),default:l(()=>[c("div",_e,[n(G,{ref_key:"myform",ref:x,"label-col":{style:{width:"80px"}},model:i(e).form,rules:i(e).rules},{default:l(()=>[n(q,{gutter:24},{default:l(()=>[n(R,{span:"24"},{default:l(()=>[n(U,{label:"一级分类",name:"title"},{default:l(()=>[n(F,{placeholder:"请输入",value:i(e).form.name,"onUpdate:value":t[0]||(t[0]=d=>i(e).form.name=d)},null,8,["value"])]),_:1})]),_:1}),n(R,{span:"24"},{default:l(()=>[n(U,{label:"封面"},{default:l(()=>[n(T,{name:"file",accept:"image/*",multiple:!1,"before-upload":$,"max-count":1,"file-list":i(v),"onUpdate:file-list":t[1]||(t[1]=d=>ae(v)?v.value=d:null)},{default:l(()=>[c("p",he,[i(e).form.imageUrl?(w(),S("img",{key:0,src:i(e).form.imageUrl,style:ie({width:`${160*i(e).form.imageWidth/i(e).form.imageHeight}px`,height:"160px"})},null,12,ve)):(w(),ne(i(de),{key:1}))]),ye]),_:1},8,["file-list"])]),_:1})]),_:1}),n(R,{span:"24"},{default:l(()=>[n(U,{label:"内容简介"},{default:l(()=>[n(j,{placeholder:"请输入",value:i(e).form.description,"onUpdate:value":t[2]||(t[2]=d=>i(e).form.description=d)},null,8,["value"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model","rules"])])]),_:1},8,["visible","title"])])])}}});const Ue=ce(we,[["__scopeId","data-v-3f180ef1"]]);export{Ue as default};
