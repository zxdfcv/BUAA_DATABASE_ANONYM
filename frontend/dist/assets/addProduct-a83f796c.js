import{s as J,u as $,z as j,r as y,a as P,O as z,w as H,A as X,H as V,l as u,b,o as f,n as m,f as l,e as n,g as o,v as T,J as C,i,j as c,C as B,p as K,k as Q}from"./index-6b603672.js";import{a as W,e as Y,u as Z}from"./product-5385049e.js";import{_ as ee}from"./_plugin-vue_export-helper-c27b6911.js";const d=_=>(K("data-v-ccfcd9e2"),_=_(),Q(),_),se={class:"content-list"},oe={key:0,class:"list-title"},te={key:1,class:"list-title"},ie={class:"list-content"},le={class:"edit-view"},ae={class:"item flex-view"},ne=d(()=>o("div",{class:"label"},"商品名称",-1)),de={class:"right-box"},re=d(()=>o("p",{class:"tip"},"支持中英文，长度不能超过 40 个字符",-1)),ce={class:"item flex-view"},ue=d(()=>o("div",{class:"label"},"售价",-1)),fe={class:"right-box"},me={class:"flex-view"},_e=d(()=>o("div",{class:"item"},[o("div",{class:"label"},"商品状态")],-1)),pe={class:"right-box",style:{"margin-top":"20px"}},ve={class:"flex-view"},he=d(()=>o("div",{class:"item"},[o("div",{class:"label"},"可选校区")],-1)),ge={class:"right-box",style:{"margin-top":"20px"}},ye={key:0,class:"flex-view"},be=d(()=>o("div",{class:"item"},[o("div",{class:"label"},"上架状态")],-1)),xe={class:"right-box",style:{"margin-top":"20px"}},we={key:1,class:"flex-view"},ke=d(()=>o("div",{class:"item"},[o("div",{class:"label"},"售出状态")],-1)),Ue={class:"right-box",style:{"margin-top":"20px"}},Oe={class:"flex-view"},Ve=d(()=>o("div",{class:"item"},[o("div",{class:"label"},"商品分类")],-1)),Se={class:"right-box",style:{"margin-top":"20px"}},De={class:"item flex-view"},Fe=d(()=>o("div",{class:"label"},"商品简介",-1)),Ie={class:"right-box"},Ne=d(()=>o("p",{class:"tip"},"限制200字以内",-1)),Pe={class:"item flex-view"},Te=d(()=>o("div",{class:"label"},"商品介绍视频",-1)),Ce={key:0},Be={key:1,class:"right-box avatar-box flex-view"},Ee={class:"change-tips flex-view"},qe=d(()=>o("label",null,"点击上传视频",-1)),Ae=d(()=>o("p",{class:"tip"},"视频大小需小于 114514 MB",-1)),Me={class:"item flex-view"},Re=d(()=>o("div",{class:"label"},"商品描述图片",-1)),Ge={key:0},Le={key:1,class:"right-box avatar-box flex-view"},Je={class:"change-tips flex-view"},$e=d(()=>o("label",null,"点击上传图片",-1)),je=d(()=>o("p",{class:"tip"},"图片格式支持 GIF、PNG、JPEG，尺寸不小于 200 PX，小于 4 MB",-1)),ze=["loading"],He=["loading"],Xe={__name:"addProduct",props:["modify","mid"],emits:["close"],setup(_,{emit:E}){const g=_,O=J(),x=$(),w=j();y(!1),y(!1),y(!1);const S=y(!0);let h=y(!1);const p=y([]),k=y([]);let s=P({form:{name:void 0,price:void 0,merchant:x.user_id,status:void 0,addr:void 0,is_sold:"0",off_shelve:"0",classification_1:void 0,classification_2:void 0,description:void 0}});P({});let D=z(()=>{for(let t=0;t<w.classificationTree.length;t++)if(s.form.classification_1===w.classificationTree[t].id)return w.classificationTree[t].children;return null});H(D,t=>{console.log(t),g.modify&&S.value?S.value=!1:s.form.classification_2=t[0].id}),X(()=>{V().query.id?V().query.id.trim()!==String(x.user_id)&&O.push({name:"wishThingView",query:{id:V().query.id.trim()}}):O.push({name:"userInfoEditView",query:{id:x.user_id}}),w.setViewId(x.user_id),g.modify&&W({product_id:g.mid}).then(t=>{console.log("get old data:",t.data),G(t.data)}).catch(t=>{u({type:"error",message:"Oops",description:"获取商品信息失败！"})})});const q=t=>{const e=new Date().getTime().toString()+"."+t.type.substring(6),v=new File([t],e);return p.value=[...p.value||[],v],!1},A=t=>{console.log(p.value);const e=p.value.indexOf(t),v=p.value.slice();v.splice(e,1),p.value=v,console.log(p.value)},M=t=>{const e=new Date().getTime().toString()+"."+t.type.substring(6),v=new File([t],e);return console.log(v),k.value=[...k.value||[],v],!1},R=()=>(k.value=[],!0),F=()=>{let t=new FormData;if(console.log(s.form),s.form.name)if(s.form.price)if(s.form.addr)if(s.form.classification_1){if(!s.form.classification_2){u({type:"error",message:"Oops",description:"商品二级分类为必填项！"});return}}else{u({type:"error",message:"Oops",description:"商品一级分类为必填项！"});return}else{u({type:"error",message:"Oops",description:"商品交易校区为必填项！"});return}else{u({type:"error",message:"Oops",description:"商品价格为必填项！"});return}else{u({type:"error",message:"Oops",description:"商品名称为必填项！"});return}for(const e in s.form)s.form[e]!==void 0&&(console.log(e),e==="is_sold"||e==="off_shelve"?(console.log(s.form[e]==="1"?"true":"false"),t.append(e,s.form[e]==="1"?"true":"false")):t.append(e,s.form[e]));h.value=!0,p.value.forEach(e=>{t.append("images",e)}),k.value.forEach(e=>{t.append("video",e)}),console.log(t),g.modify?Z({product_id:g.mid},t).then(e=>{h.value=!1,e.code===0&&(u({type:"success",message:"您修改了商品信息",description:"更新商品信息成功！"}),E("close"))}).catch(e=>{h.value=!1,console.log(e),u({type:"error",message:"Oops!",description:"修改商品信息失败！"})}):Y(t).then(e=>{h.value=!1,e.code===0?(u({type:"success",message:"成功上传商品！",description:"您成功上传了商品 "+s.form.name}),O.push({name:"usercenter",query:{id:x.user_id}})):u({type:"error",message:"Oops!",description:"商品创建失败！"})}).catch(e=>{h.value=!1,console.log(e),u({type:"error",message:"Oops!",description:e.response.data.detail})})},G=t=>{switch(s.form.name=t.name,s.form.price=Number(t.price),t.status){case"全新":s.form.status="A";break;case"几乎全新":s.form.status="B";break;case"轻微使用痕迹":s.form.status="C";break;case"明显使用痕迹":s.form.status="D";break;case"有一定问题":s.form.status="E";break}switch(t.addr){case"学院路校区":s.form.addr="1";break;case"沙河校区":s.form.addr="2";break;case"两校区均可":s.form.addr="3";break}s.form.is_sold=t.is_sold?"1":"0",s.form.off_shelve=t.off_shelve?"1":"0",s.form.classification_1=t.classification_1,s.form.classification_2=t.classification_2,s.form.description=t.description===null||t.description===void 0||t.description==="null"?"":t.description};return(t,e)=>{const v=b("a-input-number"),r=b("a-radio-button"),U=b("a-radio-group"),I=b("a-select"),N=b("a-upload"),L=b("a-spin");return f(),m("div",se,[l(L,{spinning:i(h)},{default:n(()=>[_.modify?(f(),m("div",te,"修改商品")):(f(),m("div",oe,"发布商品")),o("div",ie,[o("div",le,[o("div",ae,[ne,o("div",de,[T(o("input",{type:"text","onUpdate:modelValue":e[0]||(e[0]=a=>i(s).form.name=a),placeholder:"请输入商品名",maxlength:"40",class:"input-dom"},null,512),[[C,i(s).form.name]]),re])]),o("div",ce,[ue,o("div",fe,[l(v,{value:i(s).form.price,"onUpdate:value":e[1]||(e[1]=a=>i(s).form.price=a),controls:!1,min:0,max:999999999e-2,precision:2,prefix:"￥",placeholder:"请输入预估售价",style:{width:"400px"}},null,8,["value","max"])])]),o("div",me,[_e,o("div",pe,[l(U,{value:i(s).form.status,"onUpdate:value":e[2]||(e[2]=a=>i(s).form.status=a),"button-style":"solid"},{default:n(()=>[l(r,{value:"A"},{default:n(()=>[c("全新")]),_:1}),l(r,{value:"B"},{default:n(()=>[c("几乎全新")]),_:1}),l(r,{value:"C"},{default:n(()=>[c("轻微使用痕迹")]),_:1}),l(r,{value:"D"},{default:n(()=>[c("明显使用痕迹")]),_:1}),l(r,{value:"E"},{default:n(()=>[c("有一定问题")]),_:1})]),_:1},8,["value"])])]),o("div",ve,[he,o("div",ge,[l(U,{value:i(s).form.addr,"onUpdate:value":e[3]||(e[3]=a=>i(s).form.addr=a),"button-style":"solid"},{default:n(()=>[l(r,{value:"1"},{default:n(()=>[c("学院路校区")]),_:1}),l(r,{value:"2"},{default:n(()=>[c("沙河校区")]),_:1}),l(r,{value:"3"},{default:n(()=>[c("两校区均可")]),_:1})]),_:1},8,["value"])])]),g.modify?(f(),m("div",ye,[be,o("div",xe,[l(U,{value:i(s).form.off_shelve,"onUpdate:value":e[4]||(e[4]=a=>i(s).form.off_shelve=a),"button-style":"solid"},{default:n(()=>[l(r,{value:"0"},{default:n(()=>[c("商品上架")]),_:1}),l(r,{value:"1"},{default:n(()=>[c("商品下架")]),_:1})]),_:1},8,["value"])])])):B("",!0),g.modify?(f(),m("div",we,[ke,o("div",Ue,[l(U,{value:i(s).form.is_sold,"onUpdate:value":e[5]||(e[5]=a=>i(s).form.is_sold=a),"button-style":"solid"},{default:n(()=>[l(r,{value:"0"},{default:n(()=>[c("未售出")]),_:1}),l(r,{value:"1"},{default:n(()=>[c("已售出")]),_:1})]),_:1},8,["value"])])])):B("",!0),o("div",Oe,[Ve,o("div",Se,[l(I,{value:i(s).form.classification_1,"onUpdate:value":e[6]||(e[6]=a=>i(s).form.classification_1=a),style:{width:"120px"},options:i(w).classificationTree,"field-names":{label:"label",value:"id"},placeholder:"一级分类"},null,8,["value","options"]),l(I,{value:i(s).form.classification_2,"onUpdate:value":e[7]||(e[7]=a=>i(s).form.classification_2=a),style:{width:"120px","margin-left":"20px"},options:i(D),"field-names":{label:"label",value:"id"},placeholder:"二级分类"},null,8,["value","options"])])]),o("div",De,[Fe,o("div",Ie,[T(o("textarea",{"onUpdate:modelValue":e[8]||(e[8]=a=>i(s).form.description=a),placeholder:"请输入简介",maxlength:"200",class:"intro"},`\r
          `,512),[[C,i(s).form.description]]),Ne])]),o("div",Pe,[Te,_.modify?(f(),m("div",Ce,"暂不支持修改商品视频")):(f(),m("div",Be,[o("div",Ee,[l(N,{name:"file",accept:"video/*","file-list":i(k),multiple:!1,"max-count":1,"before-upload":M,onRemove:R},{default:n(()=>[qe]),_:1},8,["file-list"]),Ae])]))]),o("div",Me,[Re,_.modify?(f(),m("div",Ge,"暂不支持修改商品图片")):(f(),m("div",Le,[o("div",Je,[l(N,{name:"file",accept:"image/*",multiple:!0,"max-count":9,"file-list":i(p),"before-upload":q,onRemove:A},{default:n(()=>[$e]),_:1},8,["file-list"]),je])]))]),_.modify?(f(),m("button",{key:3,class:"save mg",onClick:e[10]||(e[10]=a=>F()),loading:i(h)},"修改商品",8,He)):(f(),m("button",{key:2,class:"save mg",onClick:e[9]||(e[9]=a=>F()),loading:i(h)},"发布商品",8,ze))])])]),_:1},8,["spinning"])])}}},Ye=ee(Xe,[["__scopeId","data-v-ccfcd9e2"]]);export{Ye as default};
