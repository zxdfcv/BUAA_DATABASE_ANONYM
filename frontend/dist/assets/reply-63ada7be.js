import{W as ee,X as te,Y as oe,a4 as ae,d as ne,r as S,a as U,A as le,af as se,D as ie,b as d,o as y,n as w,g as _,f as o,e as a,j as m,C as K,F as re,B as de,c as ce,t as me,h as ue,i as l,M as f,p as pe,k as _e}from"./index-6d07a472.js";import{e as fe}from"./exportCsv-f7ca4da5.js";import{D as ge}from"./DownOutlined-854325f4.js";import{_ as ve}from"./_plugin-vue_export-helper-c27b6911.js";const ye=async c=>ee({url:"/myapp/admin/reply/list",params:c,data:{},headers:{}}),ke=async c=>te({url:"/myapp/admin/reply/create",params:{},data:c,headers:{"Content-Type":"multipart/form-data;charset=utf-8"}}),he=async(c,g)=>oe({url:"/myapp/admin/reply/update",params:c,data:g,headers:{"Content-Type":"multipart/form-data;charset=utf-8"}}),L=async c=>ae({url:"/myapp/admin/reply/delete",params:c,headers:{}}),we=c=>(pe("data-v-2d9cb22f"),c=c(),_e(),c),xe={class:"page-view"},Ce={class:"table-operations"},be={key:0},Ie=["onClick"],Se=we(()=>_("a",{href:"#"},"删除",-1)),Ue={key:1},Ae={style:{"padding-right":"16px","max-height":"480px","overflow-x":"hidden","overflow-y":"auto"}},De=ne({__name:"reply",setup(c){const g=S(),z=S(!1),E=U([{title:"序号",dataIndex:"id",key:"id",align:"center"},{title:"用户",dataIndex:"user_name",key:"user_name",align:"center"},{title:"@用户 id",dataIndex:"mentioned_user",key:"mentioned_user",align:"center"},{title:"商品名称",dataIndex:"product_name",key:"product_name",align:"center"},{title:"回复内容",dataIndex:"content",key:"content",align:"center"},{title:"点赞者id",dataIndex:"likes",key:"likes",align:"center"},{title:"回复时间",dataIndex:"create_time",key:"create_time",align:"center"},{title:"操作",dataIndex:"action",key:"operation",align:"center",fixed:"right",width:140}]),s=U({list:[],userList:[],loading:!1,currentAdminUserName:"",keyword:"",selectedRowKeys:[],pageSize:10,page:1}),t=U({visile:!1,editFlag:!1,title:"",form:{id:void 0,user:void 0,mentioned_user:void 0,comment:"",content:"",image:void 0,is_read:void 0,comment_read:void 0,likes:[],link:void 0},rules:{link:[{required:!0,message:"请输入",trigger:"change"}]}});le(()=>{M(),v()});const M=()=>{s.loading=!0,se({}).then(n=>{s.loading=!1,console.log(n),n.data.forEach((e,r)=>{e.index=r+1}),s.userList=n.data}).catch(n=>{s.loading=!1,console.log(n)})},v=()=>{s.loading=!0,ye({keyword:s.keyword}).then(n=>{s.loading=!1,console.log(n),n.data.forEach((e,r)=>{e.index=r+1,e.is_read=e.is_read?"1":"0",e.comment_read=e.comment_read?"1":"0",e.image&&(e.image=ie+e.image),e.content&&e.content.length>50&&(e.content=e.content.substring(0,50)+"..."),e.canteen_title!==void 0?e.title=e.canteen_title:e.classification_title!=null&&(e.title=e.classification_title)}),s.list=n.data}).catch(n=>{s.loading=!1,console.log(n)})},N=()=>{fe(s.list,"回复信息.csv")},V=()=>{R(),t.visile=!0,t.editFlag=!1,t.title="新增";for(const n in t.form)t.form[n]=void 0},$=n=>{R(),t.visile=!0,t.editFlag=!0,t.title="编辑";for(const e in t.form)t.form[e]=void 0;for(const e in n)t.form[e]=n[e]},T=S({onChange:(n,e)=>{console.log(`selectedRowKeys: ${n}`,"selectedRows: ",e),s.selectedRowKeys=n}}),O=n=>{console.log("delete",n),L({ids:n.id}).then(e=>{v()}).catch(e=>{f.error(e.msg||"操作失败")})},j=()=>{if(console.log(s.selectedRowKeys),s.selectedRowKeys.length<=0){console.log("hello"),f.warn("请勾选删除项");return}L({ids:s.selectedRowKeys.join(",")}).then(n=>{f.success("删除成功"),s.selectedRowKeys=[],v()}).catch(n=>{f.error(n.msg||"操作失败")})},A=()=>{var n;(n=g.value)==null||n.validate().then(()=>{const e=new FormData;t.form.mentioned_user&&e.append("product",t.form.mentioned_user),t.form.content&&e.append("content",t.form.content),t.form.user&&e.append("user",t.form.user),t.form.likes&&t.form.likes.forEach(r=>{e.append("likes",r)}),t.form.is_read&&e.append("is_read",t.form.is_read==="1"?"true":"false"),t.form.comment_read&&e.append("comment_read",t.form.comment_read==="1"?"true":"false"),t.form.comment&&e.append("comment",t.form.comment),t.form.mentioned_user&&e.append("mentioned_user",t.form.mentioned_user),t.editFlag?he({reply_id:t.form.id},e).then(r=>{x(),v()}).catch(r=>{console.log(r),f.error(r.msg||"操作失败")}):ke(e).then(r=>{x(),v()}).catch(r=>{console.log(r),f.error(r.msg||"操作失败")})}).catch(e=>{console.log("不能为空")})},D=()=>{x()},R=()=>{var n;(n=g.value)==null||n.resetFields()},x=()=>{t.visile=!1};return(n,e)=>{const r=d("a-button"),q=d("a-space"),F=d("a-divider"),P=d("a-popconfirm"),W=d("a-menu-item"),X=d("a-menu"),Y=d("a-dropdown"),G=d("a-table"),C=d("a-input"),u=d("a-form-item"),p=d("a-col"),H=d("a-textarea"),b=d("a-select"),k=d("a-select-option"),J=d("a-row"),Q=d("a-form"),Z=d("a-modal");return y(),w("div",null,[_("div",xe,[_("div",Ce,[o(q,null,{default:a(()=>[o(r,{type:"primary",onClick:N},{default:a(()=>[m("导出 CSV")]),_:1}),o(r,{type:"primary",onClick:V},{default:a(()=>[m("新增")]),_:1}),o(r,{onClick:j},{default:a(()=>[m("批量删除")]),_:1})]),_:1})]),o(G,{size:"middle",rowKey:"id",loading:l(s).loading,columns:l(E),"data-source":l(s).list,scroll:{x:"max-content"},"row-selection":l(T),pagination:{size:"default",current:l(s).page,pageSize:l(s).pageSize,onChange:i=>l(s).page=i,showSizeChanger:!1,showTotal:i=>`共${i}条数据`}},{bodyCell:a(({text:i,record:I,index:Re,column:B})=>[B.key==="operation"?(y(),w("span",be,[_("a",{onClick:h=>$(I)},"编辑",8,Ie),o(F,{type:"vertical"}),o(P,{title:"确定删除?","ok-text":"是","cancel-text":"否",onConfirm:h=>O(I)},{default:a(()=>[Se]),_:2},1032,["onConfirm"])])):K("",!0),B.key==="likes"?(y(),w("span",Ue,[o(F,{type:"vertical"}),o(Y,{trigger:["click"]},{overlay:a(()=>[o(X,null,{default:a(()=>[(y(!0),w(re,null,de(I.likes,h=>(y(),ce(W,{key:h},{default:a(()=>[m(me(h),1)]),_:2},1024))),128))]),_:2},1024)]),default:a(()=>[_("a",{class:"ant-dropdown-link",onClick:e[0]||(e[0]=ue(()=>{},["prevent"]))},[m(" 点我 "),o(l(ge))])]),_:2},1024)])):K("",!0)]),_:1},8,["loading","columns","data-source","row-selection","pagination"])]),_("div",null,[o(Z,{visible:l(t).visile,forceRender:!0,title:l(t).title,width:"880px","ok-text":"确认","cancel-text":"取消",onCancel:D,onOk:A},{footer:a(()=>[o(r,{key:"back",onClick:D},{default:a(()=>[m("取消")]),_:1}),o(r,{key:"submit",type:"primary",loading:l(z),onClick:A},{default:a(()=>[m("确认")]),_:1},8,["loading"])]),default:a(()=>[_("div",Ae,[o(Q,{ref_key:"myform",ref:g,"label-col":{style:{width:"80px"}},model:l(t).form,rules:l(t).rules},{default:a(()=>[o(J,{gutter:24},{default:a(()=>[o(p,{span:"12"},{default:a(()=>[o(u,{label:"用户 id",name:"receiver_id"},{default:a(()=>[o(C,{placeholder:"请输入",value:l(t).form.user,"onUpdate:value":e[1]||(e[1]=i=>l(t).form.user=i)},null,8,["value"])]),_:1})]),_:1}),o(p,{span:"12"},{default:a(()=>[o(u,{label:"@用户 id",name:"product_id"},{default:a(()=>[o(C,{placeholder:"请输入",value:l(t).form.mentioned_user,"onUpdate:value":e[2]||(e[2]=i=>l(t).form.mentioned_user=i)},null,8,["value"])]),_:1})]),_:1}),o(p,{span:"12"},{default:a(()=>[o(u,{label:"所在评论 id",name:"product_id"},{default:a(()=>[o(C,{placeholder:"请输入",value:l(t).form.comment,"onUpdate:value":e[3]||(e[3]=i=>l(t).form.comment=i)},null,8,["value"])]),_:1})]),_:1}),o(p,{span:"24"},{default:a(()=>[o(u,{label:"内容"},{default:a(()=>[o(H,{placeholder:"请输入",value:l(t).form.content,"onUpdate:value":e[4]||(e[4]=i=>l(t).form.content=i)},null,8,["value"])]),_:1})]),_:1}),o(p,{span:"24"},{default:a(()=>[o(u,{label:"点赞用户"},{default:a(()=>[o(b,{value:l(t).form.likes,"onUpdate:value":e[5]||(e[5]=i=>l(t).form.likes=i),mode:"multiple",style:{width:"100%"},placeholder:"Please select",options:l(s).userList,"field-names":{label:"username",value:"id",options:"permissions"},render:i=>i.name},null,8,["value","options","render"])]),_:1})]),_:1}),o(p,{span:"8"},{default:a(()=>[o(u,{label:"评论已读",name:"status"},{default:a(()=>[o(b,{placeholder:"请选择",allowClear:"",value:l(t).form.comment_read,"onUpdate:value":e[6]||(e[6]=i=>l(t).form.comment_read=i)},{default:a(()=>[o(k,{key:"0",value:"0"},{default:a(()=>[m("是")]),_:1}),o(k,{key:"1",value:"1"},{default:a(()=>[m("否")]),_:1})]),_:1},8,["value"])]),_:1})]),_:1}),o(p,{span:"8"},{default:a(()=>[o(u,{label:"已读",name:"status"},{default:a(()=>[o(b,{placeholder:"请选择",allowClear:"",value:l(t).form.is_read,"onUpdate:value":e[7]||(e[7]=i=>l(t).form.is_read=i)},{default:a(()=>[o(k,{key:"0",value:"0"},{default:a(()=>[m("是")]),_:1}),o(k,{key:"1",value:"1"},{default:a(()=>[m("否")]),_:1})]),_:1},8,["value"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model","rules"])])]),_:1},8,["visible","title"])])])}}});const ze=ve(De,[["__scopeId","data-v-2d9cb22f"]]);export{ze as default};
