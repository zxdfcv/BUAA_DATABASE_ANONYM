import{s as C,u as N,z as P,r as v,a as V,A as T,H as b,Z as G,_ as M,b as w,o as y,n as k,f as u,e as U,g as e,i as a,D as $,v as h,J as g,q as J,$ as L,l as c,a0 as O,a1 as z,p as H,k as X}from"./index-6b603672.js";import{A as Z}from"./avatar-4ee3f7af.js";import{_ as j}from"./_plugin-vue_export-helper-c27b6911.js";const n=m=>(H("data-v-c4c1ccde"),m=m(),X(),m),K={class:"content-list"},Q=n(()=>e("div",{class:"list-title"},"设置",-1)),W={class:"list-content"},Y={class:"edit-view"},ee={class:"item flex-view"},se=n(()=>e("div",{class:"label"},"头像",-1)),te={class:"right-box avatar-box flex-view"},oe=["src"],ae=["src"],ie={class:"change-tips flex-view"},le=n(()=>e("label",null,"点击更换头像",-1)),ne=n(()=>e("p",{class:"tip"},"图片格式支持 GIF、PNG、JPEG，尺寸不小于 200 PX，小于 4 MB",-1)),de={class:"item flex-view"},re=n(()=>e("div",{class:"label"},"昵称",-1)),ce={class:"right-box"},pe=n(()=>e("p",{class:"tip"},"支持中英文，长度不能超过 20 个字符",-1)),ue={class:"item flex-view"},me=n(()=>e("div",{class:"label"},"手机号",-1)),_e={class:"right-box"},fe={class:"item flex-view"},ve=n(()=>e("div",{class:"label"},"邮箱",-1)),we={class:"right-box"},he={class:"item flex-view"},ge=n(()=>e("div",{class:"label"},"个人简介",-1)),xe={class:"right-box"},be=n(()=>e("p",{class:"tip"},"限制200字以内",-1)),ye={class:"item flex-view",style:{"max-width":"400px","min-width":"250px"}},ke=n(()=>e("div",{class:"label"},"当前密码",-1)),Ue={class:"right-box"},Ae={class:"item flex-view",style:{"max-width":"400px","min-width":"250px"}},Ie=n(()=>e("div",{class:"label"},"新密码",-1)),Se={class:"right-box"},Ve={class:"item flex-view",style:{"max-width":"400px","min-width":"250px"}},De=n(()=>e("div",{class:"label"},"确认新密码",-1)),Fe={class:"right-box"},Ee=n(()=>e("p",null,"确定要注销账号吗，这个操作不可撤销！您的数据将从数据库中永久删除！",-1)),qe={__name:"userinfo-edit-view",setup(m){const A=C(),d=N(),I=P(),_=v(!1);v(!1);const p=v(!1);let f=v(!1),o=V({form:{avatar:void 0,avatarFile:void 0,nickname:void 0,email:void 0,mobile:void 0,description:void 0}});const l=V({});T(()=>{b().query.id?b().query.id.trim()!==String(d.user_id)&&A.push({name:"wishThingView",query:{id:b().query.id.trim()}}):A.push({name:"userInfoEditView",query:{id:d.user_id}}),I.setViewId(d.user_id),S()});const D=async()=>{_.value=!0,await L({user_id:d.user_id}).then(t=>{c({type:"success",message:"您已成功注销!",description:""}),d.delete()}).catch(t=>{console.log(t),c({type:"error",message:"Oops!",description:t.response.data.detail}),_.value=!1,p.value=!1}),_.value=!1,p.value=!1},F=t=>{const s=new Date().getTime().toString()+"."+t.type.substring(6),r=new File([t],s);return console.log(r),o.form.avatarFile=r,!1},S=()=>{f.value=!0;let t=d.user_id;G({user_id:t}).then(s=>{o.form=s.data,console.log(o.form),o.form.avatar&&(d.user_avatar=o.form.avatar,I.view_user_avatar=o.form.avatar,localStorage.setItem(M,d.user_avatar)),f.value=!1}).catch(s=>{console.log(s),f.value=!1})},E=()=>{let t=new FormData,s=d.user_id;o.form.avatarFile&&t.append("avatar",o.form.avatarFile),o.form.nickname&&t.append("nickname",o.form.nickname),o.form.email&&t.append("email",o.form.email),o.form.mobile&&t.append("phone",o.form.mobile),o.form.description&&t.append("description",o.form.description),t.append("username",d.user_name),console.log(t),O({user_id:s},t).then(r=>{c({type:"success",message:"用户信息修改成功！",description:""}),S()}).catch(r=>{c({type:"error",message:"用户信息修改失败",description:r.response.data.detail}),console.log(r)})},q=()=>{!l.old||!l.new1||!l.new2?c({type:"error",message:"修改密码失败",description:"请输入字段！"}):l.new1!==l.new2?c({type:"error",message:"修改密码失败",description:"两次输入的密码不一致！"}):z({user_id:d.user_id},{old_password:l.old,new_password1:l.new1,new_password2:l.new2}).then(t=>{console.log(t),c({type:"success",message:"修改密码成功！",description:t.msg})}).catch(t=>{console.log(t);let s="";t.response.data.data.old_password?s=t.response.data.data.old_password[0]:t.response.data.data.new_password1?s=t.response.data.data.new_password1[0]:t.response.data.data.new_password2?(s=t.response.data.data.new_password2[0],console.log(s)):s=t.response.data.detail,c({type:"error",message:"修改密码失败",description:s})})};return(t,s)=>{const r=w("a-upload"),x=w("a-input-password"),R=w("a-modal"),B=w("a-spin");return y(),k("div",K,[Q,u(B,{spinning:a(f),style:{"min-height":"200px"}},{default:U(()=>[e("div",W,[e("div",Y,[e("div",ee,[se,e("div",te,[a(o).form&&a(o).form.avatar?(y(),k("img",{key:0,src:a($)+a(o).form.avatar,class:"avatar"},null,8,oe)):(y(),k("img",{key:1,src:a(Z),class:"avatar"},null,8,ae)),e("div",ie,[u(r,{name:"file",accept:"image/*",multiple:!1,"before-upload":F},{default:U(()=>[le]),_:1}),ne])])]),e("div",de,[re,e("div",ce,[h(e("input",{type:"text","onUpdate:modelValue":s[0]||(s[0]=i=>a(o).form.nickname=i),placeholder:"请输入昵称",maxlength:"20",class:"input-dom"},null,512),[[g,a(o).form.nickname]]),pe])]),e("div",ue,[me,e("div",_e,[h(e("input",{type:"text","onUpdate:modelValue":s[1]||(s[1]=i=>a(o).form.mobile=i),placeholder:"请输入手机号",maxlength:"100",class:"input-dom web-input"},null,512),[[g,a(o).form.mobile]])])]),e("div",fe,[ve,e("div",we,[h(e("input",{type:"text","onUpdate:modelValue":s[2]||(s[2]=i=>a(o).form.email=i),placeholder:"请输入邮箱",maxlength:"100",class:"input-dom web-input"},null,512),[[g,a(o).form.email]])])]),e("div",he,[ge,e("div",xe,[h(e("textarea",{"onUpdate:modelValue":s[3]||(s[3]=i=>a(o).form.description=i),placeholder:"请输入简介",maxlength:"200",class:"intro"},`\r
          `,512),[[g,a(o).form.description]]),be])]),e("button",{class:"save mg",onClick:s[4]||(s[4]=i=>E())},"保存"),e("form",null,[e("div",ye,[ke,e("div",Ue,[u(x,{placeholder:"输入当前密码",value:a(l).old,"onUpdate:value":s[5]||(s[5]=i=>a(l).old=i),autocomplete:"off"},null,8,["value"])])]),e("div",Ae,[Ie,e("div",Se,[u(x,{placeholder:"输入新密码",value:a(l).new1,"onUpdate:value":s[6]||(s[6]=i=>a(l).new1=i),autocomplete:"off"},null,8,["value"])])]),e("div",Ve,[De,e("div",Fe,[u(x,{placeholder:"重复输入密码",value:a(l).new2,"onUpdate:value":s[7]||(s[7]=i=>a(l).new2=i),autocomplete:"off"},null,8,["value"])])])]),e("button",{class:"save mg",onClick:q},"修改密码"),e("button",{class:"save mg",onClick:s[8]||(s[8]=i=>p.value=!0),style:{background:"red"}},"注销账号"),u(R,{open:a(p),"onUpdate:open":s[9]||(s[9]=i=>J(p)?p.value=i:null),title:"确认操作","confirm-loading":a(_),closable:!1,onOk:D},{default:U(()=>[Ee]),_:1},8,["open","confirm-loading"])])])]),_:1},8,["spinning"])])}}},Ne=j(qe,[["__scopeId","data-v-c4c1ccde"]]);export{Ne as default};
