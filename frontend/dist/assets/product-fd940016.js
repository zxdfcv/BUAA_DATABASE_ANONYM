import{f as o,N as xe,W as ke,X as Ce,Y as Ue,a4 as Se,d as De,u as Fe,z as Le,r as L,a as $,A as Oe,O as Ie,w as Ve,b as u,o as b,n as V,g as v,e as l,j as c,C as Ae,i,F as X,B as Y,c as B,t as J,q as Q,I as Re,af as Te,ag as ze,D as Ee,M as O,p as $e,k as Be}from"./index-6b603672.js";import{l as Ne}from"./classification1-78a7904c.js";import{l as qe}from"./classification2-f19385f0.js";import{l as He}from"./tag-228e7e62.js";import{e as Me}from"./exportCsv-f7ca4da5.js";import{F as je}from"./FileImageOutlined-12518b84.js";import{_ as Pe}from"./_plugin-vue_export-helper-c27b6911.js";var Ke={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M912 302.3L784 376V224c0-35.3-28.7-64-64-64H128c-35.3 0-64 28.7-64 64v576c0 35.3 28.7 64 64 64h592c35.3 0 64-28.7 64-64V648l128 73.7c21.3 12.3 48-3.1 48-27.6V330c0-24.6-26.7-40-48-27.7zM712 792H136V232h576v560zm176-167l-104-59.8V458.9L888 399v226zM208 360h112c4.4 0 8-3.6 8-8v-48c0-4.4-3.6-8-8-8H208c-4.4 0-8 3.6-8 8v48c0 4.4 3.6 8 8 8z"}}]},name:"video-camera",theme:"outlined"};const We=Ke;function Z(d){for(var m=1;m<arguments.length;m++){var f=arguments[m]!=null?Object(arguments[m]):{},h=Object.keys(f);typeof Object.getOwnPropertySymbols=="function"&&(h=h.concat(Object.getOwnPropertySymbols(f).filter(function(k){return Object.getOwnPropertyDescriptor(f,k).enumerable}))),h.forEach(function(k){Ge(d,k,f[k])})}return d}function Ge(d,m,f){return m in d?Object.defineProperty(d,m,{value:f,enumerable:!0,configurable:!0,writable:!0}):d[m]=f,d}var N=function(m,f){var h=Z({},m,f.attrs);return o(xe,Z({},h,{icon:We}),null)};N.displayName="VideoCameraOutlined";N.inheritAttrs=!1;const Xe=N,Ye=async d=>ke({url:"/myapp/admin/product/list",params:d,data:{},headers:{}}),Je=async d=>Ce({url:"/myapp/admin/product/create",params:{},data:d,timeout:2e4,headers:{"Content-Type":"multipart/form-data;charset=utf-8"}}),Qe=async(d,m)=>Ue({url:"/myapp/admin/product/update",params:d,data:m,headers:{"Content-Type":"multipart/form-data;charset=utf-8"}}),ee=async d=>Se({url:"/myapp/admin/product/delete",params:d,headers:{}}),q=d=>($e("data-v-90cf3a63"),d=d(),Be(),d),Ze={class:"page-view"},ea={class:"table-operations"},aa={key:0},ta=["onClick"],oa=q(()=>v("a",{href:"#"},"删除",-1)),la={style:{"padding-right":"16px","max-height":"480px","overflow-x":"hidden","overflow-y":"auto"}},ia={class:"ant-upload-drag-icon"},na=["src"],sa=q(()=>v("p",{class:"ant-upload-text"}," 请选择要新增的图片 ",-1)),ra={class:"ant-upload-drag-icon"},da=q(()=>v("p",{class:"ant-upload-text"}," 请选择要上传的文件（mp4格式） ",-1)),ca=De({__name:"product",setup(d){const m=Fe(),f=Le(),h=L(!0),k=$([{title:"序号",dataIndex:"id",key:"id",width:60},{title:"商品名称",dataIndex:"name",key:"name"},{title:"卖家",dataIndex:"merchant_name",key:"merchant_name"},{title:"是否下架",dataIndex:"off",key:"status",customRender:({text:t,record:a,index:s,column:U})=>t==="true"?"是":"否"},{title:"所属一级分类",dataIndex:"classification_1_name",key:"classification_1"},{title:"所属二级分类",dataIndex:"classification_2_name",key:"classification_2"},{title:"简介",dataIndex:"description",key:"description",customRender:({text:t,record:a,index:s,column:U})=>t?t.length>40?t.substring(0,40)+"...":t:"--",width:400},{title:"操作",dataIndex:"action",key:"operation",align:"center",fixed:"right",width:140}]),g=L([]),A=L([]),w=L(!1),r=$({userList:[],dataList:[],loading:!1,keyword:"",selectedRowKeys:[],pageSize:10,page:1}),e=$({visile:!1,editFlag:!1,title:"",cData:[],bData:[],tagData:[{}],form:{remove_images_ids:[],product_id:void 0,name:void 0,classification1:void 0,classification2:void 0,classification_1:void 0,classification_2:void 0,merchant:void 0,addr:"",tags:[],repertory:"",price:void 0,status:"",off_shelve:"",is_sold:"",image:void 0,images:void 0,imageUrl:void 0,imageHeight:void 0,imageWidth:void 0,imageFile:void 0,rawFile:void 0,description:void 0},rules:{name:[{required:!0,message:"请输入名称",trigger:"change"}],classification_1:[{required:!0,message:"请选择一级分类",trigger:"change"}],classification_2:[{required:!0,message:"请选择二级分类",trigger:"change"}],repertory:[{required:!0,message:"请输入库存",trigger:"change"}],price:[{required:!0,message:"请输入定价",trigger:"change"}],status:[{required:!0,message:"请选择状态",trigger:"change"}]}}),T=L(),ae=()=>{r.loading=!0,Te({}).then(t=>{r.loading=!1,console.log(t),t.data.forEach((a,s)=>{a.index=s+1}),r.userList=t.data}).catch(t=>{r.loading=!1,console.log(t)})};Oe(()=>{ae(),C(),ie(),ne(),se(),f.setViewId(m.user_id)});const te=t=>{const a=new Date().getTime().toString()+"."+t.type.substring(6),s=new File([t],a),U=new FileReader;let S;return U.onload=I=>{const D=new Image;D.onload=()=>{e.form.imageUrl=I.target.result,S=I.target.result,console.log(e.form.imageUrl);const E=D.width,R=D.height;e.form.imageWidth=E,e.form.imageHeight=R,console.log(e.form.imageWidth),console.log(e.form.imageHeight),console.log(S),g.value=[...g.value||[],{url:S,thumbUrl:S,name:a,file:s}]},D.src=I.target.result},U.readAsDataURL(s),ze.LIST_IGNORE},oe=t=>{console.log(g.value);const a=g.value.indexOf(t),s=g.value.slice();s.splice(a,1),g.value=s,console.log(g.value)},le=t=>{const a=new Date().getTime().toString()+"."+t.type.substring(6),s=new File([t],a);return console.log(s),e.form.rawFile=s,!1};let H=Ie(()=>{console.log(e.form);for(let t=0;t<f.classificationTree.length;t++)if(e.form.classification_1===f.classificationTree[t].id)return console.log(f.classificationTree[t].children),f.classificationTree[t].children;return null});Ve(H,t=>{console.log(t),h.value?h.value=!1:t!==null&&t.length>0?e.form.classification_2=t[0].id:e.form.classification_2=void 0});const C=()=>{r.loading=!0,Ye({keyword:r.keyword}).then(t=>{r.loading=!1,console.log(t),t.data.forEach((a,s)=>{a.index=s+1,a.is_sold=a.is_sold?"1":"0",a.off_shelve=a.off_shelve?"1":"0"}),r.dataList=t.data}).catch(t=>{r.loading=!1,console.log(t)})},ie=()=>{qe({}).then(t=>{e.cData=t.data,console.log(t.data)}),console.log(e.cData)},ne=()=>{Ne({}).then(t=>{e.bData=t.data})},se=()=>{He({}).then(t=>{t.data.forEach((a,s)=>{a.index=s+1}),e.tagData=t.data})},re=t=>{var a;r.keyword=(a=t==null?void 0:t.target)==null?void 0:a.value,console.log(r.keyword)},de=()=>{C()},ce=L({onChange:(t,a)=>{console.log(`selectedRowKeys: ${t}`,"selectedRows: ",a),r.selectedRowKeys=t}}),ue=()=>{Me(r.dataList,"商品信息")},fe=()=>{P(),e.visile=!0,e.editFlag=!1,e.title="新增";for(const t in e.form)e.form[t]=void 0;e.form.image=void 0},me=t=>{P(),e.visile=!0,e.editFlag=!0,e.title="编辑";for(const a in e.form)e.form[a]=void 0;for(const a in t)t[a]&&(e.form[a]=t[a]);e.form.product_id=t.id,e.form.image&&(e.form.imageUrl=Ee+e.form.image,e.form.image=void 0)},pe=t=>{console.log("delete",t),ee({ids:t.id}).then(a=>{C()}).catch(a=>{O.error(a.msg||"操作失败")})},_e=()=>{if(console.log(r.selectedRowKeys),r.selectedRowKeys.length<=0){console.log("hello"),O.warn("请勾选删除项");return}ee({ids:r.selectedRowKeys.join(",")}).then(t=>{O.success("删除成功"),r.selectedRowKeys=[],C()}).catch(t=>{O.error(t.msg||"操作失败")})},M=()=>{var t;(t=T.value)==null||t.validate().then(()=>{const a=new FormData;e.editFlag&&a.append("product_id",e.form.product_id||""),a.append("name",e.form.name||""),e.form.classification_1&&a.append("classification_1",e.form.classification_1||""),e.form.classification_2&&a.append("classification_2",e.form.classification_2||""),e.form.addr&&a.append("addr",e.form.addr||""),e.form.merchant&&a.append("merchant",e.form.merchant),e.form.tags&&e.form.tags.forEach(function(s){s&&a.append("tags",s)}),g.value.forEach(s=>{a.append("images",s.file)}),console.log(g.value),e.form.rawFile&&a.append("video",e.form.rawFile),e.form.remove_images_ids&&e.form.remove_images_ids.forEach(s=>{a.append("remove_images_ids",s)}),a.append("description",e.form.description||""),a.append("price",e.form.price||""),e.form.repertory>=0&&a.append("repertory",e.form.repertory),a.append("addr",e.form.addr),a.append("status",e.form.status),a.append("is_sold",e.form.is_sold==="1"?"true":"false"),a.append("off_shelve",e.form.off_shelve==="1"?"true":"false"),e.editFlag?(w.value=!0,Qe({product_id:e.form.product_id},a).then(s=>{w.value=!1,z(),C()}).catch(s=>{w.value=!1,console.log(s),O.error(s.msg||"操作失败")})):(w.value=!0,Je(a).then(s=>{w.value=!1,z(),C()}).catch(s=>{w.value=!1,console.log(s),O.error(s.msg||"操作失败")}))}).catch(a=>{console.log("不能为空")})},j=()=>{z()},P=()=>{var t;(t=T.value)==null||t.resetFields(),g.value=[],A.value=[]},z=()=>{e.visile=!1};return(t,a)=>{const s=u("a-button"),U=u("a-input-search"),S=u("a-space"),I=u("a-divider"),D=u("a-popconfirm"),E=u("a-table"),R=u("a-input"),p=u("a-form-item"),_=u("a-col"),F=u("a-select-option"),x=u("a-select"),y=u("a-radio-button"),K=u("a-radio-group"),W=u("a-upload-dragger"),ge=u("a-textarea"),ve=u("a-row"),he=u("a-form"),ye=u("a-modal");return b(),V("div",null,[v("div",Ze,[v("div",ea,[o(S,null,{default:l(()=>[o(s,{type:"primary",onClick:ue},{default:l(()=>[c("导出 CSV")]),_:1}),o(s,{type:"primary",onClick:fe},{default:l(()=>[c("新增")]),_:1}),o(s,{onClick:_e},{default:l(()=>[c("批量删除")]),_:1}),o(U,{"addon-before":"名称","enter-button":"",onSearch:de,onChange:re})]),_:1})]),o(E,{size:"middle",rowKey:"id",loading:i(r).loading,columns:i(k),"data-source":i(r).dataList,scroll:{x:"max-content"},"row-selection":i(ce),pagination:{size:"default",current:i(r).page,pageSize:i(r).pageSize,onChange:n=>i(r).page=n,showSizeChanger:!1,showTotal:n=>`共${n}条数据`}},{bodyCell:l(({text:n,record:G,index:ua,column:be})=>[be.key==="operation"?(b(),V("span",aa,[v("a",{onClick:we=>me(G)},"编辑",8,ta),o(I,{type:"vertical"}),o(D,{title:"确定删除?","ok-text":"是","cancel-text":"否",onConfirm:we=>pe(G)},{default:l(()=>[oa]),_:2},1032,["onConfirm"])])):Ae("",!0)]),_:1},8,["loading","columns","data-source","row-selection","pagination"])]),v("div",null,[o(ye,{visible:i(e).visile,forceRender:!0,title:i(e).title,width:"880px","ok-text":"确认","cancel-text":"取消",onCancel:j,onOk:M},{footer:l(()=>[o(s,{key:"back",onClick:j},{default:l(()=>[c("取消")]),_:1}),o(s,{key:"submit",type:"primary",loading:i(w),onClick:M},{default:l(()=>[c("确认")]),_:1},8,["loading"])]),default:l(()=>[v("div",la,[o(he,{ref_key:"myform",ref:T,"label-col":{style:{width:"80px"}},model:i(e).form,rules:i(e).rules},{default:l(()=>[o(ve,{gutter:24},{default:l(()=>[o(_,{span:"24"},{default:l(()=>[o(p,{label:"商品名称",name:"title"},{default:l(()=>[o(R,{placeholder:"请输入",value:i(e).form.name,"onUpdate:value":a[0]||(a[0]=n=>i(e).form.name=n)},null,8,["value"])]),_:1})]),_:1}),o(_,{span:"24"},{default:l(()=>[o(p,{label:"卖家",name:"merchanrt"},{default:l(()=>[o(x,{placeholder:"请选择",value:i(e).form.merchant,"onUpdate:value":a[1]||(a[1]=n=>i(e).form.merchant=n)},{default:l(()=>[(b(!0),V(X,null,Y(i(r).userList,n=>(b(),B(F,{value:n.id},{default:l(()=>[c(J(n.username),1)]),_:2},1032,["value"]))),256))]),_:1},8,["value"])]),_:1})]),_:1}),o(_,{span:"24"},{default:l(()=>[o(p,{label:"地址",name:"addr"},{default:l(()=>[o(K,{value:i(e).form.addr,"onUpdate:value":a[2]||(a[2]=n=>i(e).form.addr=n),"button-style":"solid"},{default:l(()=>[o(y,{value:"1"},{default:l(()=>[c("学院路校区")]),_:1}),o(y,{value:"2"},{default:l(()=>[c("沙河校区")]),_:1}),o(y,{value:"3"},{default:l(()=>[c("两校区均可")]),_:1})]),_:1},8,["value"])]),_:1})]),_:1}),o(_,{span:"12"},{default:l(()=>[o(p,{label:"一级分类",name:"classification1"},{default:l(()=>[o(x,{placeholder:"请选择",allowClear:"",options:i(f).classificationTree,"field-names":{label:"label",value:"id"},value:i(e).form.classification_1,"onUpdate:value":a[3]||(a[3]=n=>i(e).form.classification_1=n)},null,8,["options","value"])]),_:1})]),_:1}),o(_,{span:"12"},{default:l(()=>[o(p,{label:"二级分类",name:"classification2"},{default:l(()=>[o(x,{placeholder:"请选择",allowClear:"",options:i(H),"field-names":{label:"label",value:"id"},value:i(e).form.classification_2,"onUpdate:value":a[4]||(a[4]=n=>i(e).form.classification_2=n)},null,8,["options","value"])]),_:1})]),_:1}),o(_,{span:"12"},{default:l(()=>[o(p,{label:"标签"},{default:l(()=>[o(x,{mode:"multiple",placeholder:"请选择",allowClear:"",value:i(e).form.tags,"onUpdate:value":a[5]||(a[5]=n=>i(e).form.tags=n)},{default:l(()=>[(b(!0),V(X,null,Y(i(e).tagData,n=>(b(),B(F,{value:n.id},{default:l(()=>[c(J(n.name),1)]),_:2},1032,["value"]))),256))]),_:1},8,["value"])]),_:1})]),_:1}),o(_,{span:"12"},{default:l(()=>[o(p,{label:"价格"},{default:l(()=>[o(R,{placeholder:"请输入",value:i(e).form.price,"onUpdate:value":a[6]||(a[6]=n=>i(e).form.price=n)},null,8,["value"])]),_:1})]),_:1}),o(_,{span:"24"},{default:l(()=>[o(p,{label:"新增图片"},{default:l(()=>[o(W,{name:"file",accept:"image/*",multiple:!0,"max-count":9,"before-upload":te,onRemove:oe,"file-list":i(g),"onUpdate:file-list":a[7]||(a[7]=n=>Q(g)?g.value=n:null)},{default:l(()=>[v("p",ia,[i(e).form.imageUrl?(b(),V("img",{key:0,src:i(e).form.imageUrl,style:Re({width:`${160*i(e).form.imageUrl/i(e).form.imageHeight}px`,height:"160px"})},null,12,na)):(b(),B(i(je),{key:1}))]),sa]),_:1},8,["file-list"])]),_:1})]),_:1}),o(_,{span:"24"},{default:l(()=>[o(p,{label:"商品文件"},{default:l(()=>[o(W,{name:"file",accept:".mp4",multiple:!1,"before-upload":le,"max-count":1,"file-list":i(A),"onUpdate:file-list":a[8]||(a[8]=n=>Q(A)?A.value=n:null)},{default:l(()=>[v("p",ra,[o(i(Xe))]),da]),_:1},8,["file-list"])]),_:1})]),_:1}),o(_,{span:"24"},{default:l(()=>[o(p,{label:"内容简介"},{default:l(()=>[o(ge,{placeholder:"请输入",value:i(e).form.description,"onUpdate:value":a[9]||(a[9]=n=>i(e).form.description=n)},null,8,["value"])]),_:1})]),_:1}),o(_,{span:"12"},{default:l(()=>[o(p,{label:"是否下架",name:"off_shelve"},{default:l(()=>[o(x,{placeholder:"请选择",allowClear:"",value:i(e).form.off_shelve,"onUpdate:value":a[10]||(a[10]=n=>i(e).form.off_shelve=n)},{default:l(()=>[o(F,{key:"1",value:"1"},{default:l(()=>[c("是")]),_:1}),o(F,{key:"0",value:"0"},{default:l(()=>[c("否")]),_:1})]),_:1},8,["value"])]),_:1})]),_:1}),o(_,{span:"12"},{default:l(()=>[o(p,{label:"是否已售出",name:"is_sold"},{default:l(()=>[o(x,{placeholder:"请选择",allowClear:"",value:i(e).form.is_sold,"onUpdate:value":a[11]||(a[11]=n=>i(e).form.is_sold=n)},{default:l(()=>[o(F,{key:"1",value:"1"},{default:l(()=>[c("是")]),_:1}),o(F,{key:"0",value:"0"},{default:l(()=>[c("否")]),_:1})]),_:1},8,["value"])]),_:1})]),_:1}),o(_,{span:"24"},{default:l(()=>[o(p,{label:"商品状态",name:"is_sold"},{default:l(()=>[o(K,{value:i(e).form.status,"onUpdate:value":a[12]||(a[12]=n=>i(e).form.status=n),"button-style":"solid"},{default:l(()=>[o(y,{value:"A"},{default:l(()=>[c("全新")]),_:1}),o(y,{value:"B"},{default:l(()=>[c("几乎全新")]),_:1}),o(y,{value:"C"},{default:l(()=>[c("轻微使用痕迹")]),_:1}),o(y,{value:"D"},{default:l(()=>[c("明显使用痕迹")]),_:1}),o(y,{value:"E"},{default:l(()=>[c("有一定问题")]),_:1})]),_:1},8,["value"])]),_:1})]),_:1}),o(_,{span:"24"},{default:l(()=>[o(p,{label:"删除图片",name:"clear_image"},{default:l(()=>[o(x,{value:i(e).form.remove_images_ids,"onUpdate:value":a[13]||(a[13]=n=>i(e).form.remove_images_ids=n),mode:"multiple",style:{width:"100%"},placeholder:"Please select",options:i(e).form.images,"field-names":{label:"id",value:"id"},render:n=>n.id},null,8,["value","options","render"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model","rules"])])]),_:1},8,["visible","title"])])])}}});const ya=Pe(ca,[["__scopeId","data-v-90cf3a63"]]);export{ya as default};
